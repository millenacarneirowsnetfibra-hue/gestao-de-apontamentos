<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>GestÃ£o de RH - Sistema Completo</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Firebase 9 Modular -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
        import { 
            getFirestore, 
            collection, 
            addDoc, 
            getDocs, 
            doc, 
            updateDoc, 
            deleteDoc, 
            onSnapshot,
            setDoc,
            query,
            where 
        } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        const firebaseConfig = {
            apiKey: "AIzaSyDgbEXbB_WsTz_1G7m3LZSF1-YYYpqQApo",
            authDomain: "gestao-de-apontamentos.firebaseapp.com",
            projectId: "gestao-de-apontamentos",
            storageBucket: "gestao-de-apontamentos.firebasestorage.app",
            messagingSenderId: "542288976862",
            appId: "1:542288976862:web:b9ecca9ce5e1fdae871b4f"
        };

        const app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        window.firebaseApp = {
            db,
            firestore: {
                collection,
                addDoc,
                getDocs,
                doc,
                updateDoc,
                deleteDoc,
                onSnapshot,
                setDoc,
                query,
                where
            }
        };
        
        console.log("âœ… Firebase inicializado com sucesso!");
    </script>
    <style>
        :root {
            --primary-color: #2c3e50;
            --secondary-color: #3498db;
            --accent-color: #e74c3c;
            --success-color: #27ae60;
            --warning-color: #f39c12;
            --light-color: #ecf0f1;
            --dark-color: #2c3e50;
            --gray-color: #95a5a6;
            --shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
            --border-radius: 8px;
            --orange-color: #e67e22;
            --red-color: #c0392b;
            
            --card-advertencia: rgba(243, 156, 18, 0.15);
            --card-falta: rgba(231, 76, 60, 0.15);
            --card-multa: rgba(52, 152, 219, 0.15);
            --card-colaborador: rgba(46, 204, 113, 0.15);
            --card-turnover: rgba(155, 89, 182, 0.15);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Poppins', sans-serif;
            background-color: #f5f7fa;
            color: var(--dark-color);
            line-height: 1.6;
        }

        .container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 250px;
            background-color: var(--primary-color);
            color: white;
            padding: 20px 0;
            transition: all 0.3s ease;
            box-shadow: var(--shadow);
            z-index: 100;
        }

        .sidebar-header {
            padding: 0 20px 20px;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
            text-align: center;
        }

        .sidebar-header h2 {
            font-size: 1.5rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 10px;
        }

        .sidebar-header h2 i {
            color: var(--secondary-color);
        }

        .sidebar-menu {
            list-style: none;
            padding: 20px 0;
        }

        .sidebar-menu li {
            margin-bottom: 5px;
        }

        .sidebar-menu a {
            display: flex;
            align-items: center;
            padding: 12px 20px;
            color: var(--light-color);
            text-decoration: none;
            transition: all 0.3s ease;
            font-weight: 500;
        }

        .sidebar-menu a:hover, .sidebar-menu a.active {
            background-color: rgba(255, 255, 255, 0.1);
            color: white;
            border-left: 4px solid var(--secondary-color);
        }

        .sidebar-menu i {
            width: 24px;
            margin-right: 10px;
            font-size: 1.1rem;
        }

        .main-content {
            flex: 1;
            padding: 20px;
            overflow-y: auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
            padding-bottom: 15px;
            border-bottom: 1px solid #ddd;
        }

        .header h1 {
            color: var(--primary-color);
            font-size: 1.8rem;
        }

        .user-info {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background-color: var(--secondary-color);
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }

        .firebase-status {
            display: inline-flex;
            align-items: center;
            gap: 5px;
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            margin-left: 10px;
        }

        .firebase-connected {
            background-color: rgba(39, 174, 96, 0.1);
            color: var(--success-color);
        }

        .firebase-disconnected {
            background-color: rgba(231, 76, 60, 0.1);
            color: var(--accent-color);
        }

        .cards-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
            transition: transform 0.3s ease;
            border-left: 6px solid transparent;
        }

        .card:hover {
            transform: translateY(-5px);
        }

        .card-advertencia {
            background: linear-gradient(135deg, #fff9e6, white);
            border-left-color: var(--warning-color);
        }

        .card-falta {
            background: linear-gradient(135deg, #fef5f5, white);
            border-left-color: var(--accent-color);
        }

        .card-multa {
            background: linear-gradient(135deg, #ebf5ff, white);
            border-left-color: var(--secondary-color);
        }

        .card-colaborador {
            background: linear-gradient(135deg, #e8f8f0, white);
            border-left-color: var(--success-color);
        }

        .card-turnover {
            background: linear-gradient(135deg, #f4e8ff, white);
            border-left-color: #9b59b6;
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .card-title {
            font-size: 1rem;
            color: var(--gray-color);
            font-weight: 600;
        }

        .card-icon {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
            color: white;
        }

        .card-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .card-change {
            font-size: 0.9rem;
            margin-top: 5px;
            color: var(--gray-color);
        }

        .positive {
            color: var(--success-color);
        }

        .negative {
            color: var(--accent-color);
        }

        .section {
            background-color: white;
            border-radius: var(--border-radius);
            padding: 25px;
            box-shadow: var(--shadow);
            margin-bottom: 30px;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .section-title {
            font-size: 1.3rem;
            color: var(--primary-color);
            font-weight: 600;
        }

        .filters-container {
            background-color: #f8f9fa;
            border-radius: var(--border-radius);
            padding: 20px;
            margin-bottom: 20px;
            border: 1px solid #eee;
            display: none;
        }

        .filters-container.show {
            display: block;
            animation: slideDown 0.3s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .filters-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .filters-title {
            font-size: 1rem;
            color: var(--primary-color);
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .filters-title i {
            color: var(--secondary-color);
        }

        .close-filters-btn {
            background: none;
            border: none;
            color: var(--gray-color);
            font-size: 1.2rem;
            cursor: pointer;
            padding: 5px;
            transition: color 0.3s;
        }

        .close-filters-btn:hover {
            color: var(--accent-color);
        }

        .filters-row {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 15px;
        }

        .filter-group {
            flex: 1;
            min-width: 200px;
        }

        .filter-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark-color);
            font-size: 0.9rem;
        }

        .filter-input {
            width: 100%;
            padding: 10px 12px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-family: 'Poppins', sans-serif;
            font-size: 0.9rem;
            transition: border 0.3s ease;
        }

        .filter-input:focus {
            outline: none;
            border-color: var(--secondary-color);
        }

        .btn-filters {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        .btn-toggle-filters {
            background-color: var(--secondary-color);
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: var(--border-radius);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Poppins', sans-serif;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .btn-toggle-filters:hover {
            background-color: #2980b9;
        }

        .btn-toggle-filters.active {
            background-color: var(--accent-color);
        }

        .btn {
            padding: 10px 20px;
            border-radius: var(--border-radius);
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-family: 'Poppins', sans-serif;
        }

        .btn-primary {
            background-color: var(--secondary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: #2980b9;
        }

        .btn-secondary {
            background-color: var(--light-color);
            color: var(--dark-color);
        }

        .btn-secondary:hover {
            background-color: #d5dbdb;
        }

        .btn-danger {
            background-color: var(--accent-color);
            color: white;
        }

        .btn-danger:hover {
            background-color: #c0392b;
        }

        .btn-success {
            background-color: var(--success-color);
            color: white;
        }

        .btn-success:hover {
            background-color: #219a52;
        }

        .loading {
            display: flex;
            justify-content: center;
            align-items: center;
            padding: 20px;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid var(--secondary-color);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .table-container {
            overflow-x: auto;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            background-color: #f8f9fa;
            padding: 15px;
            text-align: left;
            font-weight: 600;
            color: var(--primary-color);
            border-bottom: 2px solid #eee;
        }

        td {
            padding: 15px;
            border-bottom: 1px solid #eee;
        }

        tr:hover {
            background-color: #f9f9f9;
        }

        .status {
            padding: 5px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-active {
            background-color: rgba(39, 174, 96, 0.1);
            color: var(--success-color);
        }

        .status-inactive {
            background-color: rgba(231, 76, 60, 0.1);
            color: var(--accent-color);
        }

        .status-warning {
            background-color: rgba(243, 156, 18, 0.1);
            color: var(--warning-color);
        }

        .status-info {
            background-color: rgba(52, 152, 219, 0.1);
            color: var(--secondary-color);
        }

        .status-baixo {
            background-color: rgba(39, 174, 96, 0.1);
            color: var(--success-color);
            font-weight: 600;
        }

        .status-alto {
            background-color: rgba(231, 76, 60, 0.1);
            color: var(--accent-color);
            font-weight: 600;
        }

        .action-buttons {
            display: flex;
            gap: 5px;
        }

        .action-btn {
            width: 30px;
            height: 30px;
            border-radius: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            color: white;
            border: none;
        }

        .edit-btn {
            background-color: var(--secondary-color);
        }

        .delete-btn {
            background-color: var(--accent-color);
        }

        .view-btn {
            background-color: var(--gray-color);
        }

        .form-container {
            max-width: 800px;
            margin: 0 auto;
        }

        .form-row {
            display: flex;
            flex-wrap: wrap;
            gap: 20px;
            margin-bottom: 20px;
        }

        .form-group {
            flex: 1;
            min-width: 250px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--dark-color);
        }

        .form-control {
            width: 100%;
            padding: 12px 15px;
            border: 1px solid #ddd;
            border-radius: var(--border-radius);
            font-family: 'Poppins', sans-serif;
            font-size: 1rem;
            transition: border 0.3s ease;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--secondary-color);
        }

        .form-control:read-only {
            background-color: #f8f9fa;
            color: var(--gray-color);
        }

        textarea.form-control {
            min-height: 120px;
            resize: vertical;
        }

        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: white;
            border-radius: var(--border-radius);
            width: 90%;
            max-width: 800px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }

        .modal-header {
            padding: 20px;
            border-bottom: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 1.3rem;
            color: var(--primary-color);
            font-weight: 600;
        }

        .close-btn {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: var(--gray-color);
        }

        .modal-body {
            padding: 20px;
        }

        .modal-footer {
            padding: 15px 20px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: flex-end;
            gap: 10px;
        }

        .alert {
            padding: 12px 20px;
            border-radius: var(--border-radius);
            margin-bottom: 20px;
            display: flex;
            align-items: center;
            gap: 10px;
            animation: fadeIn 0.3s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(-10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .alert-success {
            background-color: rgba(39, 174, 96, 0.1);
            color: var(--success-color);
            border: 1px solid rgba(39, 174, 96, 0.2);
        }

        .alert-error {
            background-color: rgba(231, 76, 60, 0.1);
            color: var(--accent-color);
            border: 1px solid rgba(231, 76, 60, 0.2);
        }

        .alert-warning {
            background-color: rgba(243, 156, 18, 0.1);
            color: var(--warning-color);
            border: 1px solid rgba(243, 156, 18, 0.2);
        }

        .alert-info {
            background-color: rgba(52, 152, 219, 0.1);
            color: var(--secondary-color);
            border: 1px solid rgba(52, 152, 219, 0.2);
        }

        .badge {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .badge-positivo {
            background-color: rgba(39, 174, 96, 0.1);
            color: var(--success-color);
        }

        .badge-neutro {
            background-color: rgba(230, 126, 34, 0.15);
            color: var(--orange-color);
        }

        .badge-melhorar {
            background-color: rgba(192, 57, 43, 0.15);
            color: var(--red-color);
        }

        .stats-container {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-bottom: 25px;
        }

        .stat-card {
            flex: 1;
            min-width: 200px;
            background-color: #f8f9fa;
            border-radius: var(--border-radius);
            padding: 20px;
            border: 1px solid #eee;
        }

        .stat-title {
            font-size: 0.9rem;
            color: var(--gray-color);
            font-weight: 600;
            margin-bottom: 10px;
        }

        .stat-value {
            font-size: 2rem;
            font-weight: 700;
            color: var(--primary-color);
        }

        .stat-subtitle {
            font-size: 0.8rem;
            color: var(--gray-color);
            margin-top: 5px;
        }

        .turnover-card {
            flex: 1;
            min-width: 300px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border-radius: var(--border-radius);
            padding: 25px;
            color: white;
            margin-bottom: 25px;
        }

        .turnover-card .stat-title {
            color: rgba(255, 255, 255, 0.9);
        }

        .turnover-card .stat-value {
            color: white;
        }

        .turnover-card .stat-subtitle {
            color: rgba(255, 255, 255, 0.8);
        }

        .turnover-form {
            background-color: #f8f9fa;
            border-radius: var(--border-radius);
            padding: 25px;
            margin-bottom: 25px;
            border: 1px solid #eee;
        }

        .top5-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .top5-card {
            background: white;
            border-radius: var(--border-radius);
            padding: 20px;
            box-shadow: var(--shadow);
        }

        .top5-header {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 15px;
            padding-bottom: 10px;
            border-bottom: 2px solid var(--secondary-color);
        }

        .top5-header i {
            font-size: 1.5rem;
            color: var(--secondary-color);
        }

        .top5-title {
            font-size: 1.1rem;
            font-weight: 600;
            color: var(--primary-color);
        }

        .top5-list {
            list-style: none;
        }

        .top5-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            border-bottom: 1px dashed #eee;
        }

        .top5-item:last-child {
            border-bottom: none;
        }

        .top5-name {
            font-weight: 500;
        }

        .top5-value {
            background: var(--secondary-color);
            color: white;
            padding: 2px 10px;
            border-radius: 20px;
            font-size: 0.85rem;
            font-weight: 600;
        }

        .top5-empty {
            color: var(--gray-color);
            font-style: italic;
            text-align: center;
            padding: 10px;
        }

        @media (max-width: 992px) {
            .container {
                flex-direction: column;
            }

            .sidebar {
                width: 100%;
                height: auto;
                padding: 10px 0;
            }

            .sidebar-menu {
                display: flex;
                overflow-x: auto;
                padding: 10px 0;
            }

            .sidebar-menu li {
                margin-bottom: 0;
                flex-shrink: 0;
            }

            .sidebar-menu a {
                padding: 10px 15px;
                border-left: none;
                border-bottom: 3px solid transparent;
            }

            .sidebar-menu a:hover, .sidebar-menu a.active {
                border-left: none;
                border-bottom: 3px solid var(--secondary-color);
            }
        }

        @media (max-width: 768px) {
            .header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .cards-container {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }

            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }

            .filters-row {
                flex-direction: column;
            }
            
            .filter-group {
                min-width: 100%;
            }

            .stats-container {
                flex-direction: column;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <nav class="sidebar">
            <div class="sidebar-header">
                <h2><i class="fas fa-users-cog"></i> GestÃ£o de RH</h2>
                <div class="firebase-status" id="firebase-status">
                    <i class="fas fa-cloud"></i> <span>Conectando...</span>
                </div>
            </div>
            <ul class="sidebar-menu">
                <li><a href="#" class="active" data-section="dashboard"><i class="fas fa-tachometer-alt"></i> Dashboard</a></li>
                <li><a href="#" data-section="turnover"><i class="fas fa-chart-line"></i> Turnover</a></li>
                <li><a href="#" data-section="empresas"><i class="fas fa-building"></i> Empresas</a></li>
                <li><a href="#" data-section="departamentos"><i class="fas fa-sitemap"></i> Departamentos</a></li>
                <li><a href="#" data-section="colaboradores"><i class="fas fa-user-tie"></i> Colaboradores</a></li>
                <li><a href="#" data-section="tipos-multa"><i class="fas fa-tag"></i> Tipos de Multa</a></li>
                <li><a href="#" data-section="advertencias"><i class="fas fa-exclamation-triangle"></i> AdvertÃªncias</a></li>
                <li><a href="#" data-section="danos"><i class="fas fa-tools"></i> Danos e Avarias</a></li>
                <li><a href="#" data-section="faltas"><i class="fas fa-calendar-times"></i> Faltas</a></li>
                <li><a href="#" data-section="feedbacks"><i class="fas fa-comment-dots"></i> Feedbacks</a></li>
                <li><a href="#" data-section="multas"><i class="fas fa-money-bill-wave"></i> Multas</a></li>
            </ul>
        </nav>

        <main class="main-content">
            <div class="header">
                <h1 id="page-title">Dashboard</h1>
                <div class="user-info">
                    <div class="user-avatar">ADM</div>
                    <div>
                        <div class="user-name">Administrador</div>
                        <div class="user-role">Sistema</div>
                    </div>
                </div>
            </div>

            <div id="dashboard" class="section-content">
                <div class="cards-container">
                    <div class="card card-colaborador">
                        <div class="card-header">
                            <div class="card-title">Total de Colaboradores</div>
                            <div class="card-icon" style="background-color: var(--success-color);">
                                <i class="fas fa-users"></i>
                            </div>
                        </div>
                        <div class="card-value" id="total-colaboradores">0</div>
                        <div class="card-change positive"><i class="fas fa-sync"></i> Em tempo real</div>
                    </div>
                    <div class="card card-advertencia">
                        <div class="card-header">
                            <div class="card-title">AdvertÃªncias</div>
                            <div class="card-icon" style="background-color: var(--warning-color);">
                                <i class="fas fa-exclamation-triangle"></i>
                            </div>
                        </div>
                        <div class="card-value" id="total-advertencias">0</div>
                        <div class="card-change">Total geral</div>
                    </div>
                    <div class="card card-falta">
                        <div class="card-header">
                            <div class="card-title">Faltas</div>
                            <div class="card-icon" style="background-color: var(--accent-color);">
                                <i class="fas fa-calendar-times"></i>
                            </div>
                        </div>
                        <div class="card-value" id="total-faltas">0</div>
                        <div class="card-change">Total geral</div>
                    </div>
                    <div class="card card-multa">
                        <div class="card-header">
                            <div class="card-title">Valor Total Multas</div>
                            <div class="card-icon" style="background-color: var(--secondary-color);">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                        </div>
                        <div class="card-value" id="total-multas">R$ 0,00</div>
                        <div class="card-change">Total geral</div>
                    </div>
                </div>

                <div class="top5-grid">
                    <div class="top5-card">
                        <div class="top5-header">
                            <i class="fas fa-exclamation-triangle" style="color: var(--warning-color);"></i>
                            <div class="top5-title">Top 5 - AdvertÃªncias por Colaborador</div>
                        </div>
                        <ul class="top5-list" id="top5-advertencias-colaboradores">
                            <li class="top5-empty">Carregando...</li>
                        </ul>
                    </div>
                    
                    <div class="top5-card">
                        <div class="top5-header">
                            <i class="fas fa-sitemap" style="color: var(--warning-color);"></i>
                            <div class="top5-title">Top 5 - AdvertÃªncias por Setor</div>
                        </div>
                        <ul class="top5-list" id="top5-advertencias-setores">
                            <li class="top5-empty">Carregando...</li>
                        </ul>
                    </div>
                </div>

                <div class="top5-grid">
                    <div class="top5-card">
                        <div class="top5-header">
                            <i class="fas fa-tools" style="color: #e67e22;"></i>
                            <div class="top5-title">Top 5 - Danos/Avarias por Colaborador</div>
                        </div>
                        <ul class="top5-list" id="top5-danos-colaboradores">
                            <li class="top5-empty">Carregando...</li>
                        </ul>
                    </div>
                    
                    <div class="top5-card">
                        <div class="top5-header">
                            <i class="fas fa-sitemap" style="color: #e67e22;"></i>
                            <div class="top5-title">Top 5 - Danos/Avarias por Setor</div>
                        </div>
                        <ul class="top5-list" id="top5-danos-setores">
                            <li class="top5-empty">Carregando...</li>
                        </ul>
                    </div>
                </div>

                <div class="top5-grid">
                    <div class="top5-card">
                        <div class="top5-header">
                            <i class="fas fa-calendar-times" style="color: var(--accent-color);"></i>
                            <div class="top5-title">Top 5 - Faltas por Colaborador</div>
                        </div>
                        <ul class="top5-list" id="top5-faltas-colaboradores">
                            <li class="top5-empty">Carregando...</li>
                        </ul>
                    </div>
                    
                    <div class="top5-card">
                        <div class="top5-header">
                            <i class="fas fa-sitemap" style="color: var(--accent-color);"></i>
                            <div class="top5-title">Top 5 - Faltas por Setor</div>
                        </div>
                        <ul class="top5-list" id="top5-faltas-setores">
                            <li class="top5-empty">Carregando...</li>
                        </ul>
                    </div>
                </div>

                <div class="top5-grid">
                    <div class="top5-card">
                        <div class="top5-header">
                            <i class="fas fa-comment-dots" style="color: var(--success-color);"></i>
                            <div class="top5-title">Top 5 - Feedbacks Totais por Setor</div>
                        </div>
                        <ul class="top5-list" id="top5-feedbacks-total">
                            <li class="top5-empty">Carregando...</li>
                        </ul>
                    </div>
                    
                    <div class="top5-card">
                        <div class="top5-header">
                            <i class="fas fa-smile" style="color: var(--success-color);"></i>
                            <div class="top5-title">Top 5 - Feedbacks Positivos por Setor</div>
                        </div>
                        <ul class="top5-list" id="top5-feedbacks-positivos">
                            <li class="top5-empty">Carregando...</li>
                        </ul>
                    </div>
                    
                    <div class="top5-card">
                        <div class="top5-header">
                            <i class="fas fa-meh" style="color: var(--orange-color);"></i>
                            <div class="top5-title">Top 5 - Feedbacks Neutros por Setor</div>
                        </div>
                        <ul class="top5-list" id="top5-feedbacks-neutros">
                            <li class="top5-empty">Carregando...</li>
                        </ul>
                    </div>
                    
                    <div class="top5-card">
                        <div class="top5-header">
                            <i class="fas fa-frown" style="color: var(--red-color);"></i>
                            <div class="top5-title">Top 5 - A Melhorar por Setor</div>
                        </div>
                        <ul class="top5-list" id="top5-feedbacks-melhorar">
                            <li class="top5-empty">Carregando...</li>
                        </ul>
                    </div>
                </div>

                <div class="top5-grid">
                    <div class="top5-card">
                        <div class="top5-header">
                            <i class="fas fa-money-bill-wave" style="color: var(--secondary-color);"></i>
                            <div class="top5-title">Top 5 - Multas por Colaborador</div>
                        </div>
                        <ul class="top5-list" id="top5-multas-colaboradores">
                            <li class="top5-empty">Carregando...</li>
                        </ul>
                    </div>
                    
                    <div class="top5-card">
                        <div class="top5-header">
                            <i class="fas fa-sitemap" style="color: var(--secondary-color);"></i>
                            <div class="top5-title">Top 5 - Multas por Setor</div>
                        </div>
                        <ul class="top5-list" id="top5-multas-setores">
                            <li class="top5-empty">Carregando...</li>
                        </ul>
                    </div>
                </div>
            </div>

            <div id="turnover" class="section-content" style="display: none;">
                <div class="section">
                    <div class="section-header">
                        <h3 class="section-title">ðŸ“Š GestÃ£o de Turnover</h3>
                        <button class="btn btn-primary" id="add-turnover-btn">
                            <i class="fas fa-plus"></i> Novo Registro de Turnover
                        </button>
                    </div>
                    <div id="turnover-alert"></div>
                    
                    <div class="turnover-card">
                        <div class="stat-title">Taxa de Turnover Atual</div>
                        <div class="stat-value" id="turnover-taxa-atual">0,00%</div>
                        <div class="stat-subtitle" id="turnover-status-atual">MÃªs atual</div>
                    </div>
                    
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>MÃªs/Ano</th>
                                    <th>Colaboradores InÃ­cio</th>
                                    <th>AdmissÃµes</th>
                                    <th>Desligamentos</th>
                                    <th>Colaboradores Fim</th>
                                    <th>Taxa Turnover</th>
                                    <th>ClassificaÃ§Ã£o</th>
                                    <th>AÃ§Ãµes</th>
                                </tr>
                            </thead>
                            <tbody id="turnover-table-body">
                                <tr>
                                    <td colspan="8" class="loading">
                                        <div class="loading-spinner"></div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="empresas" class="section-content" style="display: none;">
                <div class="section">
                    <div class="section-header">
                        <h3 class="section-title">Empresas</h3>
                        <button class="btn btn-primary" id="add-empresa-btn">Adicionar Empresa</button>
                    </div>
                    <div id="empresas-alert"></div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>AÃ§Ãµes</th>
                                </tr>
                            </thead>
                            <tbody id="empresas-table-body">
                                <tr>
                                    <td colspan="2" class="loading">
                                        <div class="loading-spinner"></div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="departamentos" class="section-content" style="display: none;">
                <div class="section">
                    <div class="section-header">
                        <h3 class="section-title">Departamentos</h3>
                        <button class="btn btn-primary" id="add-departamento-btn">Adicionar Departamento</button>
                    </div>
                    <div id="departamentos-alert"></div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>AÃ§Ãµes</th>
                                </tr>
                            </thead>
                            <tbody id="departamentos-table-body">
                                <tr>
                                    <td colspan="2" class="loading">
                                        <div class="loading-spinner"></div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="colaboradores" class="section-content" style="display: none;">
                <div class="section">
                    <div class="section-header">
                        <h3 class="section-title">Colaboradores</h3>
                        <button class="btn btn-primary" id="add-colaborador-btn">Adicionar Colaborador</button>
                    </div>
                    
                    <div class="btn-filters">
                        <button class="btn-toggle-filters" id="toggle-filters-colaboradores">
                            <i class="fas fa-filter"></i> Mostrar Filtros
                        </button>
                    </div>
                    
                    <div class="filters-container" id="filters-colaboradores">
                        <div class="filters-header">
                            <h4 class="filters-title"><i class="fas fa-filter"></i> Filtros</h4>
                            <button class="close-filters-btn" onclick="closeFilters('colaboradores')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="filters-row">
                            <div class="filter-group">
                                <label for="filtro-status-colaborador">Status</label>
                                <select id="filtro-status-colaborador" class="filter-input">
                                    <option value="todos">Todos</option>
                                    <option value="Ativo" selected>Ativos</option>
                                    <option value="Inativo">Inativos</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label for="filtro-nome-colaborador">Nome</label>
                                <input type="text" id="filtro-nome-colaborador" class="filter-input" placeholder="Digite o nome...">
                            </div>
                        </div>
                        <div class="filters-row">
                            <div class="filter-group">
                                <label for="filtro-departamento-colaborador">Departamento</label>
                                <select id="filtro-departamento-colaborador" class="filter-input">
                                    <option value="">Todos os departamentos</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label for="filtro-empresa-colaborador">Empresa</label>
                                <select id="filtro-empresa-colaborador" class="filter-input">
                                    <option value="">Todas as empresas</option>
                                </select>
                            </div>
                        </div>
                    </div>
                    
                    <div id="colaboradores-alert"></div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Nome</th>
                                    <th>Departamento</th>
                                    <th>Empresa</th>
                                    <th>Data AdmissÃ£o</th>
                                    <th>Status</th>
                                    <th>AÃ§Ãµes</th>
                                </tr>
                            </thead>
                            <tbody id="colaboradores-table-body">
                                <tr>
                                    <td colspan="6" class="loading">
                                        <div class="loading-spinner"></div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="tipos-multa" class="section-content" style="display: none;">
                <div class="section">
                    <div class="section-header">
                        <h3 class="section-title">Tipos de Multa</h3>
                        <button class="btn btn-primary" id="add-tipo-multa-btn">
                            <i class="fas fa-plus"></i> Cadastrar Tipo de Multa
                        </button>
                    </div>
                    <div id="tipos-multa-alert"></div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Nome do Tipo</th>
                                    <th>AÃ§Ãµes</th>
                                </tr>
                            </thead>
                            <tbody id="tiposMulta-table-body">
                                <tr>
                                    <td colspan="2" class="loading">
                                        <div class="loading-spinner"></div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="advertencias" class="section-content" style="display: none;">
                <div class="section">
                    <div class="section-header">
                        <h3 class="section-title">AdvertÃªncias</h3>
                        <button class="btn btn-primary" id="add-advertencia-btn">Adicionar AdvertÃªncia</button>
                    </div>
                    
                    <div class="btn-filters">
                        <button class="btn-toggle-filters" id="toggle-filters-advertencias">
                            <i class="fas fa-filter"></i> Mostrar Filtros
                        </button>
                    </div>
                    
                    <div class="filters-container" id="filters-advertencias">
                        <div class="filters-header">
                            <h4 class="filters-title"><i class="fas fa-filter"></i> Filtros</h4>
                            <button class="close-filters-btn" onclick="closeFilters('advertencias')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="filters-row">
                            <div class="filter-group">
                                <label for="filtro-nome">Nome do Colaborador</label>
                                <input type="text" id="filtro-nome" class="filter-input" placeholder="Digite o nome...">
                            </div>
                            <div class="filter-group">
                                <label for="filtro-departamento">Departamento</label>
                                <select id="filtro-departamento" class="filter-input">
                                    <option value="">Todos os departamentos</option>
                                </select>
                            </div>
                        </div>
                        <div class="filters-row">
                            <div class="filter-group">
                                <label for="filtro-data-inicio">Data InÃ­cio</label>
                                <input type="date" id="filtro-data-inicio" class="filter-input">
                            </div>
                            <div class="filter-group">
                                <label for="filtro-data-fim">Data Fim</label>
                                <input type="date" id="filtro-data-fim" class="filter-input">
                            </div>
                        </div>
                    </div>
                    
                    <div id="advertencias-alert"></div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Colaborador</th>
                                    <th>Departamento</th>
                                    <th>Data</th>
                                    <th>Motivo</th>
                                    <th>AÃ§Ãµes</th>
                                </tr>
                            </thead>
                            <tbody id="advertencias-table-body">
                                <tr>
                                    <td colspan="5" class="loading">
                                        <div class="loading-spinner"></div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="danos" class="section-content" style="display: none;">
                <div class="section">
                    <div class="section-header">
                        <h3 class="section-title">Danos e Avarias</h3>
                        <button class="btn btn-primary" id="add-dano-btn">Registrar Dano/Avaria</button>
                    </div>
                    
                    <div class="btn-filters">
                        <button class="btn-toggle-filters" id="toggle-filters-danos">
                            <i class="fas fa-filter"></i> Mostrar Filtros
                        </button>
                    </div>
                    
                    <div class="filters-container" id="filters-danos">
                        <div class="filters-header">
                            <h4 class="filters-title"><i class="fas fa-filter"></i> Filtros</h4>
                            <button class="close-filters-btn" onclick="closeFilters('danos')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="filters-row">
                            <div class="filter-group">
                                <label for="filtro-nome-dano">Nome do Colaborador</label>
                                <input type="text" id="filtro-nome-dano" class="filter-input" placeholder="Digite o nome...">
                            </div>
                            <div class="filter-group">
                                <label for="filtro-departamento-dano">Departamento</label>
                                <select id="filtro-departamento-dano" class="filter-input">
                                    <option value="">Todos os departamentos</option>
                                </select>
                            </div>
                        </div>
                        <div class="filters-row">
                            <div class="filter-group">
                                <label for="filtro-data-inicio-dano">Data InÃ­cio</label>
                                <input type="date" id="filtro-data-inicio-dano" class="filter-input">
                            </div>
                            <div class="filter-group">
                                <label for="filtro-data-fim-dano">Data Fim</label>
                                <input type="date" id="filtro-data-fim-dano" class="filter-input">
                            </div>
                        </div>
                    </div>

                    <div class="danos-stats-container" style="display: flex; gap: 15px; margin-bottom: 25px;">
                        <div class="danos-stat-card" style="flex: 1; min-width: 200px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: var(--border-radius); padding: 20px; color: white;">
                            <div class="stat-title" style="color: rgba(255, 255, 255, 0.9);">Valor Total Gastos</div>
                            <div class="stat-value" style="color: white; font-size: 2rem; font-weight: 700;" id="stat-danos-valor-total">R$ 0,00</div>
                            <div class="stat-subtitle" style="color: rgba(255, 255, 255, 0.8);">com filtros aplicados</div>
                        </div>
                        <div class="danos-stat-card" style="flex: 1; min-width: 200px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: var(--border-radius); padding: 20px; color: white;">
                            <div class="stat-title" style="color: rgba(255, 255, 255, 0.9);">Total de Registros</div>
                            <div class="stat-value" style="color: white; font-size: 2rem; font-weight: 700;" id="stat-danos-total">0</div>
                            <div class="stat-subtitle" style="color: rgba(255, 255, 255, 0.8);">com filtros aplicados</div>
                        </div>
                    </div>
                    
                    <div id="danos-alert"></div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Colaborador</th>
                                    <th>Departamento</th>
                                    <th>Data</th>
                                    <th>Motivo</th>
                                    <th>Valor (R$)</th>
                                    <th>AÃ§Ãµes</th>
                                </tr>
                            </thead>
                            <tbody id="danos-table-body">
                                <tr>
                                    <td colspan="6" class="loading">
                                        <div class="loading-spinner"></div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="faltas" class="section-content" style="display: none;">
                <div class="section">
                    <div class="section-header">
                        <h3 class="section-title">Faltas</h3>
                        <button class="btn btn-primary" id="add-falta-btn">Registrar Falta</button>
                    </div>
                    
                    <div class="btn-filters">
                        <button class="btn-toggle-filters" id="toggle-filters-faltas">
                            <i class="fas fa-filter"></i> Mostrar Filtros
                        </button>
                    </div>
                    
                    <div class="filters-container" id="filters-faltas">
                        <div class="filters-header">
                            <h4 class="filters-title"><i class="fas fa-filter"></i> Filtros</h4>
                            <button class="close-filters-btn" onclick="closeFilters('faltas')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="filters-row">
                            <div class="filter-group">
                                <label for="filtro-nome-falta">Nome do Colaborador</label>
                                <input type="text" id="filtro-nome-falta" class="filter-input" placeholder="Digite o nome...">
                            </div>
                            <div class="filter-group">
                                <label for="filtro-departamento-falta">Departamento</label>
                                <select id="filtro-departamento-falta" class="filter-input">
                                    <option value="">Todos os departamentos</option>
                                </select>
                            </div>
                        </div>
                        <div class="filters-row">
                            <div class="filter-group">
                                <label for="filtro-data-inicio-falta">Data InÃ­cio</label>
                                <input type="date" id="filtro-data-inicio-falta" class="filter-input">
                            </div>
                            <div class="filter-group">
                                <label for="filtro-data-fim-falta">Data Fim</label>
                                <input type="date" id="filtro-data-fim-falta" class="filter-input">
                            </div>
                        </div>
                    </div>

                    <div class="faltas-stats-container" style="display: flex; gap: 15px; margin-bottom: 25px;">
                        <div class="faltas-stat-card" style="flex: 1; min-width: 200px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: var(--border-radius); padding: 20px; color: white;">
                            <div class="stat-title" style="color: rgba(255, 255, 255, 0.9);">Total de Faltas</div>
                            <div class="stat-value" style="color: white; font-size: 2rem; font-weight: 700;" id="stat-faltas-total">0</div>
                            <div class="stat-subtitle" style="color: rgba(255, 255, 255, 0.8);">com filtros aplicados</div>
                        </div>
                    </div>
                    
                    <div id="faltas-alert"></div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Colaborador</th>
                                    <th>Departamento</th>
                                    <th>Data da Falta</th>
                                    <th>PerÃ­odo</th>
                                    <th>Quantidade</th>
                                    <th>Justificativa</th>
                                    <th>AÃ§Ãµes</th>
                                </tr>
                            </thead>
                            <tbody id="faltas-table-body">
                                <tr>
                                    <td colspan="7" class="loading">
                                        <div class="loading-spinner"></div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="feedbacks" class="section-content" style="display: none;">
                <div class="section">
                    <div class="section-header">
                        <h3 class="section-title">Feedbacks</h3>
                        <button class="btn btn-primary" id="add-feedback-btn">Adicionar Feedback</button>
                    </div>
                    
                    <div class="btn-filters">
                        <button class="btn-toggle-filters" id="toggle-filters-feedbacks">
                            <i class="fas fa-filter"></i> Mostrar Filtros
                        </button>
                    </div>
                    
                    <div class="filters-container" id="filters-feedbacks">
                        <div class="filters-header">
                            <h4 class="filters-title"><i class="fas fa-filter"></i> Filtros</h4>
                            <button class="close-filters-btn" onclick="closeFilters('feedbacks')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="filters-row">
                            <div class="filter-group">
                                <label for="filtro-mes-feedback">MÃªs/Ano</label>
                                <input type="month" id="filtro-mes-feedback" class="filter-input">
                            </div>
                            <div class="filter-group">
                                <label for="filtro-departamento-feedback">Departamento</label>
                                <select id="filtro-departamento-feedback" class="filter-input">
                                    <option value="">Todos os departamentos</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="stats-container">
                        <div class="stat-card">
                            <div class="stat-title">Positivos</div>
                            <div class="stat-value" id="stat-positivos">0</div>
                            <div class="stat-subtitle" id="stat-positivos-subtitle">Total geral</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-title">Neutros</div>
                            <div class="stat-value" id="stat-neutros">0</div>
                            <div class="stat-subtitle" id="stat-neutros-subtitle">Total geral</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-title">A Melhorar</div>
                            <div class="stat-value" id="stat-melhorar">0</div>
                            <div class="stat-subtitle" id="stat-melhorar-subtitle">Total geral</div>
                        </div>
                        <div class="stat-card">
                            <div class="stat-title">Total</div>
                            <div class="stat-value" id="stat-total-feedbacks">0</div>
                            <div class="stat-subtitle" id="stat-total-subtitle">Total geral</div>
                        </div>
                    </div>
                    
                    <div id="feedbacks-alert"></div>
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>MÃªs/Ano</th>
                                    <th>Departamento</th>
                                    <th>Positivos</th>
                                    <th>Neutros</th>
                                    <th>A Melhorar</th>
                                    <th>Total</th>
                                    <th>AÃ§Ãµes</th>
                                </tr>
                            </thead>
                            <tbody id="feedbacks-table-body">
                                <tr>
                                    <td colspan="7" class="loading">
                                        <div class="loading-spinner"></div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>

            <div id="multas" class="section-content" style="display: none;">
                <div class="section">
                    <div class="section-header">
                        <h3 class="section-title">GestÃ£o de Multas</h3>
                        <button class="btn btn-primary" id="add-multa-btn">
                            <i class="fas fa-plus"></i> Registrar Multa
                        </button>
                    </div>

                    <div class="btn-filters">
                        <button class="btn-toggle-filters" id="toggle-filters-multas">
                            <i class="fas fa-filter"></i> Mostrar Filtros
                        </button>
                    </div>

                    <div class="filters-container" id="filters-multas">
                        <div class="filters-header">
                            <h4 class="filters-title"><i class="fas fa-filter"></i> Filtros</h4>
                            <button class="close-filters-btn" onclick="closeFilters('multas')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="filters-row">
                            <div class="filter-group">
                                <label for="filtro-nome-multa">Nome do Colaborador</label>
                                <input type="text" id="filtro-nome-multa" class="filter-input" placeholder="Digite o nome...">
                            </div>
                            <div class="filter-group">
                                <label for="filtro-departamento-multa">Departamento</label>
                                <select id="filtro-departamento-multa" class="filter-input">
                                    <option value="">Todos os departamentos</option>
                                </select>
                            </div>
                        </div>
                        <div class="filters-row">
                            <div class="filter-group">
                                <label for="filtro-status-multa">Status</label>
                                <select id="filtro-status-multa" class="filter-input">
                                    <option value="">Todos os status</option>
                                    <option value="Colaborador ciente">Colaborador ciente</option>
                                    <option value="Aguardando CNH">Aguardando CNH</option>
                                    <option value="IndicaÃ§Ã£o realizada">IndicaÃ§Ã£o realizada</option>
                                    <option value="IndicaÃ§Ã£o aceita">IndicaÃ§Ã£o aceita</option>
                                    <option value="Aguardando penalidade">Aguardando penalidade</option>
                                    <option value="Desconto Realizado">Desconto Realizado</option>
                                    <option value="Processo finalizado">Processo finalizado</option>
                                    <option value="Aguardando recurso">Aguardando recurso</option>
                                </select>
                            </div>
                            <div class="filter-group">
                                <label for="filtro-placa-multa">Placa do VeÃ­culo</label>
                                <input type="text" id="filtro-placa-multa" class="filter-input" placeholder="Digite a placa...">
                            </div>
                        </div>
                        <div class="filters-row">
                            <div class="filter-group">
                                <label for="filtro-ait-multa">NÃºmero do AIT</label>
                                <input type="text" id="filtro-ait-multa" class="filter-input" placeholder="Digite o AIT...">
                            </div>
                            <div class="filter-group">
                                <label for="filtro-data-inicio-multa">Data InÃ­cio</label>
                                <input type="date" id="filtro-data-inicio-multa" class="filter-input">
                            </div>
                            <div class="filter-group">
                                <label for="filtro-data-fim-multa">Data Fim</label>
                                <input type="date" id="filtro-data-fim-multa" class="filter-input">
                            </div>
                        </div>
                    </div>

                    <div class="multas-stats-container" style="display: flex; gap: 15px; margin-bottom: 25px;">
                        <div class="multa-stat-card" style="flex: 1; min-width: 200px; background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); border-radius: var(--border-radius); padding: 20px; color: white;">
                            <div class="stat-title" style="color: rgba(255, 255, 255, 0.9);">Total de Multas</div>
                            <div class="stat-value" style="color: white; font-size: 2rem; font-weight: 700;" id="stat-multas-total">0</div>
                            <div class="stat-subtitle" style="color: rgba(255, 255, 255, 0.8);">registros</div>
                        </div>
                        <div class="multa-stat-card" style="flex: 1; min-width: 200px; background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%); border-radius: var(--border-radius); padding: 20px; color: white;">
                            <div class="stat-title" style="color: rgba(255, 255, 255, 0.9);">Valor Total</div>
                            <div class="stat-value" style="color: white; font-size: 2rem; font-weight: 700;" id="stat-valor-total">R$ 0,00</div>
                            <div class="stat-subtitle" style="color: rgba(255, 255, 255, 0.8);">total geral</div>
                        </div>
                    </div>

                    <div id="multas-alert"></div>
                    
                    <div class="table-container">
                        <table>
                            <thead>
                                <tr>
                                    <th>Colaborador</th>
                                    <th>Departamento</th>
                                    <th>Data/Hora</th>
                                    <th>Tipo</th>
                                    <th>Placa</th>
                                    <th>AIT</th>
                                    <th>Local</th>
                                    <th>Valor (R$)</th>
                                    <th>Status</th>
                                    <th>Data Limite</th>
                                    <th>AÃ§Ãµes</th>
                                </tr>
                            </thead>
                            <tbody id="multas-table-body">
                                <tr>
                                    <td colspan="11" class="loading">
                                        <div class="loading-spinner"></div>
                                    </td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </main>
    </div>

    <div id="modal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title" id="modal-title">Adicionar Novo Item</h3>
                <button class="close-btn" id="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="modal-form"></form>
            </div>
            <div class="modal-footer">
                <button class="btn btn-secondary" id="cancel-form">Cancelar</button>
                <button class="btn btn-primary" id="submit-form">Salvar</button>
            </div>
        </div>
    </div>

    <script>
        // ConfiguraÃ§Ã£o do sistema
        const collections = {
            empresas: 'empresas',
            departamentos: 'departamentos',
            colaboradores: 'colaboradores',
            advertencias: 'advertencias',
            danos: 'danos',
            faltas: 'faltas',
            feedbacks: 'feedbacks',
            tiposMulta: 'tiposMulta',
            multas: 'multas',
            turnover: 'turnover'
        };

        // Cache de dados para selects
        let empresasData = [];
        let departamentosData = [];
        let colaboradoresData = [];
        let tiposMultaData = [];
        let turnoverData = [];

        // Estado
        let currentSection = 'dashboard';
        let currentAction = 'add';
        let currentItemId = null;
        let currentCollection = null;
        let unsubscribeListeners = {};

        // Elementos DOM
        const firebaseStatus = document.getElementById('firebase-status');

        // FunÃ§Ã£o para classificar taxa de turnover
        function classificarTurnover(taxa) {
            const taxaNumerica = parseFloat(taxa) || 0;
            
            if (taxaNumerica < 5) {
                return {
                    texto: 'Baixo',
                    classe: 'status-baixo',
                    icone: 'fa-check-circle'
                };
            } else {
                return {
                    texto: 'Alto',
                    classe: 'status-alto',
                    icone: 'fa-exclamation-triangle'
                };
            }
        }

        // FunÃ§Ã£o para alternar visibilidade dos filtros
        window.toggleFilters = function(section) {
            const filtersContainer = document.getElementById(`filters-${section}`);
            const toggleBtn = document.getElementById(`toggle-filters-${section}`);
            
            if (filtersContainer) {
                filtersContainer.classList.toggle('show');
                if (filtersContainer.classList.contains('show')) {
                    toggleBtn.innerHTML = '<i class="fas fa-times"></i> Ocultar Filtros';
                    toggleBtn.classList.add('active');
                } else {
                    toggleBtn.innerHTML = '<i class="fas fa-filter"></i> Mostrar Filtros';
                    toggleBtn.classList.remove('active');
                }
            }
        };

        // FunÃ§Ã£o para fechar filtros
        window.closeFilters = function(section) {
            const filtersContainer = document.getElementById(`filters-${section}`);
            const toggleBtn = document.getElementById(`toggle-filters-${section}`);
            
            if (filtersContainer) {
                filtersContainer.classList.remove('show');
                if (toggleBtn) {
                    toggleBtn.innerHTML = '<i class="fas fa-filter"></i> Mostrar Filtros';
                    toggleBtn.classList.remove('active');
                }
            }
        };

        // Testar conexÃ£o com Firebase
        async function testFirebaseConnection() {
            try {
                console.log('Testando conexÃ£o com Firebase...');
                
                if (!window.firebaseApp || !window.firebaseApp.db) {
                    throw new Error('Firebase nÃ£o inicializado');
                }

                const empresasRef = firebaseApp.firestore.collection(firebaseApp.db, 'empresas');
                const snapshot = await firebaseApp.firestore.getDocs(empresasRef);
                
                firebaseStatus.className = 'firebase-status firebase-connected';
                firebaseStatus.innerHTML = '<i class="fas fa-cloud"></i> <span>Conectado</span>';
                console.log(`âœ… Firebase conectado! Empresas encontradas: ${snapshot.size}`);
                
                return true;
            } catch (error) {
                console.error('Firebase error:', error);
                firebaseStatus.className = 'firebase-status firebase-disconnected';
                firebaseStatus.innerHTML = `<i class="fas fa-cloud"></i> <span>Erro: ${error.code || error.message}</span>`;
                return false;
            }
        }

        // InicializaÃ§Ã£o
        document.addEventListener('DOMContentLoaded', async function() {
            console.log('AplicaÃ§Ã£o iniciando...');
            
            await new Promise(resolve => setTimeout(resolve, 1000));
            
            if (!window.firebaseApp) {
                console.error('Firebase nÃ£o carregou corretamente');
                alert('Erro: Firebase nÃ£o carregou. Verifique o console (F12) para detalhes.');
                return;
            }

            const connected = await testFirebaseConnection();
            if (!connected) {
                alert('ERRO: NÃ£o foi possÃ­vel conectar ao Firebase.\n\n1. Verifique se as regras do Firestore estÃ£o abertas\n2. Verifique sua conexÃ£o com a internet');
                return;
            }

            setupEventListeners();
            await loadInitialData();
            setupRealtimeListeners();
            
            console.log('âœ… AplicaÃ§Ã£o inicializada com sucesso!');
        });

        // Setup de listeners em tempo real
        function setupRealtimeListeners() {
            console.log('Configurando listeners em tempo real...');
            
            Object.keys(collections).forEach(section => {
                const collectionName = collections[section];
                
                try {
                    const collectionRef = firebaseApp.firestore.collection(firebaseApp.db, collectionName);
                    
                    unsubscribeListeners[section] = firebaseApp.firestore.onSnapshot(
                        collectionRef,
                        (snapshot) => {
                            console.log(`${section}: ${snapshot.size} documentos (tempo real)`);
                            
                            // Atualizar cache primeiro
                            updateCache(section, snapshot);
                            
                            // Depois atualizar a tabela com os filtros atuais
                            if (section === currentSection || section === 'colaboradores' || section === 'departamentos' || section === 'feedbacks' || section === 'turnover') {
                                const docs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                                
                                if (section === 'colaboradores') {
                                    const filteredDocs = applyColaboradoresFilters(docs);
                                    updateTableFromSnapshot(section, snapshot, filteredDocs);
                                } else if (section === 'advertencias') {
                                    const filteredDocs = applyAdvertenciasFilters(docs);
                                    updateTableFromSnapshot(section, snapshot, filteredDocs);
                                } else if (section === 'faltas') {
                                    const filteredDocs = applyFaltasFilters(docs);
                                    updateTableFromSnapshot(section, snapshot, filteredDocs);
                                    updateFaltasStats(filteredDocs);
                                } else if (section === 'danos') {
                                    const filteredDocs = applyDanosFilters(docs);
                                    updateTableFromSnapshot(section, snapshot, filteredDocs);
                                    updateDanosStats(filteredDocs);
                                } else if (section === 'feedbacks') {
                                    const filteredDocs = applyFeedbacksFilters(docs);
                                    updateTableFromSnapshot(section, snapshot, filteredDocs);
                                    updateFeedbackStats(filteredDocs, false);
                                } else if (section === 'multas') {
                                    const filteredDocs = applyMultasFilters(docs);
                                    updateTableFromSnapshot(section, snapshot, filteredDocs);
                                    updateMultasStats();
                                } else if (section === 'turnover') {
                                    turnoverData = docs.sort((a, b) => b.mesAno.localeCompare(a.mesAno));
                                    updateTableFromSnapshot(section, snapshot, turnoverData);
                                    updateTurnoverTaxaAtual();
                                } else {
                                    updateTableFromSnapshot(section, snapshot);
                                }
                            }
                            
                            // Atualizar dashboard
                            if (section === 'colaboradores' || section === 'advertencias' || section === 'faltas' || section === 'multas' || section === 'danos' || section === 'feedbacks') {
                                updateDashboardCounts();
                            }
                            
                            if (section === 'departamentos' || section === 'colaboradores' || section === 'feedbacks') {
                                updateColaboradoresFilterOptions();
                                updateFeedbackSelects();
                                updateMultasFilterOptions();
                            }
                        },
                        (error) => {
                            console.error(`Erro listener ${section}: ${error.message}`);
                        }
                    );
                    
                } catch (error) {
                    console.error(`Erro ao configurar listener ${section}: ${error.message}`);
                }
            });
        }

        // Atualizar opÃ§Ãµes dos filtros de multas
        function updateMultasFilterOptions() {
            const deptoFilter = document.getElementById('filtro-departamento-multa');
            
            if (deptoFilter) {
                const valorAtual = deptoFilter.value;
                deptoFilter.innerHTML = '<option value="">Todos os departamentos</option>';
                const departamentosUnicos = [...new Set(departamentosData.map(d => d.nome).filter(Boolean))];
                departamentosUnicos.sort().forEach(depto => {
                    const option = document.createElement('option');
                    option.value = depto;
                    option.textContent = depto;
                    deptoFilter.appendChild(option);
                });
                if (valorAtual) deptoFilter.value = valorAtual;
            }
        }

        // Atualizar opÃ§Ãµes dos filtros de feedbacks
        function updateFeedbackSelects() {
            const deptoFilter = document.getElementById('filtro-departamento-feedback');
            
            if (deptoFilter) {
                const valorAtual = deptoFilter.value;
                deptoFilter.innerHTML = '<option value="">Todos os departamentos</option>';
                const departamentosUnicos = [...new Set(departamentosData.map(d => d.nome).filter(Boolean))];
                departamentosUnicos.sort().forEach(depto => {
                    const option = document.createElement('option');
                    option.value = depto;
                    option.textContent = depto;
                    deptoFilter.appendChild(option);
                });
                if (valorAtual) deptoFilter.value = valorAtual;
            }
        }

        // Atualizar opÃ§Ãµes dos filtros de colaboradores
        function updateColaboradoresFilterOptions() {
            const deptoFilter = document.getElementById('filtro-departamento-colaborador');
            const empresaFilter = document.getElementById('filtro-empresa-colaborador');
            
            if (deptoFilter) {
                const valorAtual = deptoFilter.value;
                deptoFilter.innerHTML = '<option value="">Todos os departamentos</option>';
                const departamentosUnicos = [...new Set(departamentosData.map(d => d.nome).filter(Boolean))];
                departamentosUnicos.sort().forEach(depto => {
                    const option = document.createElement('option');
                    option.value = depto;
                    option.textContent = depto;
                    deptoFilter.appendChild(option);
                });
                if (valorAtual) deptoFilter.value = valorAtual;
            }
            
            if (empresaFilter) {
                const valorAtual = empresaFilter.value;
                empresaFilter.innerHTML = '<option value="">Todas as empresas</option>';
                const empresasUnicas = [...new Set(empresasData.map(e => e.nome).filter(Boolean))];
                empresasUnicas.sort().forEach(empresa => {
                    const option = document.createElement('option');
                    option.value = empresa;
                    option.textContent = empresa;
                    empresaFilter.appendChild(option);
                });
                if (valorAtual) empresaFilter.value = valorAtual;
            }
        }

        // Atualizar cache
        function updateCache(section, snapshot) {
            const docs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            
            if (section === 'empresas') {
                empresasData = docs.sort((a, b) => (a.nome || '').localeCompare(b.nome || ''));
            } else if (section === 'departamentos') {
                departamentosData = docs.sort((a, b) => (a.nome || '').localeCompare(b.nome || ''));
            } else if (section === 'colaboradores') {
                colaboradoresData = docs.sort((a, b) => (a.nome || '').localeCompare(b.nome || ''));
            } else if (section === 'tiposMulta') {
                tiposMultaData = docs.sort((a, b) => (a.nome || '').localeCompare(b.nome || ''));
            } else if (section === 'turnover') {
                turnoverData = docs.sort((a, b) => b.mesAno.localeCompare(a.mesAno));
            }
        }

        // Carregar dados iniciais
        async function loadInitialData() {
            console.log('Carregando dados iniciais...');
            
            try {
                for (const section in collections) {
                    await loadTableData(section);
                }
                
                await updateDashboardCounts();
                updateMultasStats();
                updateColaboradoresFilterOptions();
                updateFeedbackSelects();
                updateMultasFilterOptions();
                updateTurnoverTaxaAtual();
                
                // Carregar feedbacks sem filtros para mostrar total geral
                const feedbacksRef = firebaseApp.firestore.collection(firebaseApp.db, 'feedbacks');
                const feedbacksSnapshot = await firebaseApp.firestore.getDocs(feedbacksRef);
                const feedbacksDocs = feedbacksSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                updateFeedbackStats(feedbacksDocs, true);
                
                console.log('âœ… Dados iniciais carregados');
            } catch (error) {
                console.error(`Erro ao carregar dados: ${error.message}`);
            }
        }

        // Calcular taxa de turnover
        function calcularTaxaTurnover(inicio, admissao, desligamento, fim) {
            inicio = parseInt(inicio) || 0;
            admissao = parseInt(admissao) || 0;
            desligamento = parseInt(desligamento) || 0;
            fim = parseInt(fim) || 0;
            
            if (inicio === 0 || fim === 0) return 0;
            
            const mediaColaboradores = (inicio + fim) / 2;
            if (mediaColaboradores === 0) return 0;
            
            const taxa = (desligamento / mediaColaboradores) * 100;
            return taxa.toFixed(2);
        }

        // Validar registro de turnover
        function validarRegistroTurnover(formData) {
            const inicio = parseInt(formData.colaboradoresInicio) || 0;
            const admissao = parseInt(formData.admissoes) || 0;
            const desligamento = parseInt(formData.desligamentos) || 0;
            const fim = parseInt(formData.colaboradoresFim) || 0;
            
            if (inicio === 0 || fim === 0) {
                return { valido: false, mensagem: 'Os campos Colaboradores InÃ­cio e Fim devem ser preenchidos' };
            }
            
            if (inicio + admissao - desligamento !== fim) {
                return { 
                    valido: false, 
                    mensagem: `Os nÃºmeros nÃ£o batem: InÃ­cio (${inicio}) + AdmissÃµes (${admissao}) - Desligamentos (${desligamento}) deveria ser igual a Fim (${fim}), mas o resultado Ã© ${inicio + admissao - desligamento}` 
                };
            }
            
            return { valido: true };
        }

        // Atualizar estatÃ­sticas de turnover
        function updateTurnoverTaxaAtual() {
            const hoje = new Date();
            const mesAtual = `${hoje.getFullYear()}-${String(hoje.getMonth() + 1).padStart(2, '0')}`;
            
            const registroAtual = turnoverData.find(r => r.mesAno === mesAtual);
            
            if (registroAtual) {
                const taxa = registroAtual.taxaTurnover || calcularTaxaTurnover(
                    registroAtual.colaboradoresInicio,
                    registroAtual.admissoes,
                    registroAtual.desligamentos,
                    registroAtual.colaboradoresFim
                );
                
                const classificacao = classificarTurnover(taxa);
                
                document.getElementById('turnover-taxa-atual').textContent = `${taxa}%`;
                const statusElement = document.getElementById('turnover-status-atual');
                statusElement.innerHTML = `MÃªs atual - <span style="display: inline-block; padding: 4px 12px; border-radius: 20px; background-color: ${classificacao.classe === 'status-baixo' ? 'rgba(39, 174, 96, 0.2)' : 'rgba(231, 76, 60, 0.2)'}; color: ${classificacao.classe === 'status-baixo' ? 'var(--success-color)' : 'var(--accent-color)'};">${classificacao.texto}</span>`;
            } else {
                document.getElementById('turnover-taxa-atual').textContent = '0,00%';
                document.getElementById('turnover-status-atual').innerHTML = 'MÃªs atual - Sem registro';
            }
        }

        // Atualizar estatÃ­sticas de danos com filtros
        function updateDanosStats(danos) {
            let valorTotal = 0;
            
            danos.forEach(dano => {
                valorTotal += parseFloat(dano.valor) || 0;
            });
            
            const statValorTotal = document.getElementById('stat-danos-valor-total');
            const statTotal = document.getElementById('stat-danos-total');
            
            if (statValorTotal) statValorTotal.textContent = `R$ ${valorTotal.toFixed(2)}`;
            if (statTotal) statTotal.textContent = danos.length;
        }

        // Atualizar estatÃ­sticas de faltas com filtros
        function updateFaltasStats(faltas) {
            let totalFaltas = 0;
            
            faltas.forEach(falta => {
                totalFaltas += parseInt(falta.quantidade) || 1;
            });
            
            const statFaltasTotal = document.getElementById('stat-faltas-total');
            if (statFaltasTotal) statFaltasTotal.textContent = totalFaltas;
        }

        // FunÃ§Ã£o para verificar se uma data estÃ¡ no intervalo
        function dataEstaNoIntervalo(dataStr, dataInicio, dataFim) {
            if (!dataStr) return false;
            
            const data = new Date(dataStr);
            if (isNaN(data.getTime())) return false;
            
            if (dataInicio) {
                const inicio = new Date(dataInicio);
                inicio.setHours(0, 0, 0, 0);
                if (data < inicio) return false;
            }
            
            if (dataFim) {
                const fim = new Date(dataFim);
                fim.setHours(23, 59, 59, 999);
                if (data > fim) return false;
            }
            
            return true;
        }

        // FunÃ§Ã£o para calcular dias entre duas datas
        function calcularDiasEntreDatas(dataInicio, dataFim) {
            if (!dataInicio || !dataFim) return 1;
            
            const inicio = new Date(dataInicio);
            const fim = new Date(dataFim);
            
            if (isNaN(inicio.getTime()) || isNaN(fim.getTime())) return 1;
            
            inicio.setHours(0, 0, 0, 0);
            fim.setHours(0, 0, 0, 0);
            
            const diffTime = fim.getTime() - inicio.getTime();
            const diffDays = Math.ceil(diffTime / (1000 * 60 * 60 * 24)) + 1;
            
            return diffDays > 0 ? diffDays : 1;
        }

        // Atualizar dashboard
        async function updateDashboardCounts() {
            try {
                const colaboradoresRef = firebaseApp.firestore.collection(firebaseApp.db, 'colaboradores');
                const colaboradoresSnapshot = await firebaseApp.firestore.getDocs(colaboradoresRef);
                document.getElementById('total-colaboradores').textContent = colaboradoresSnapshot.size;
                
                const advertenciasRef = firebaseApp.firestore.collection(firebaseApp.db, 'advertencias');
                const advertenciasSnapshot = await firebaseApp.firestore.getDocs(advertenciasRef);
                let advertenciasDocs = advertenciasSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                document.getElementById('total-advertencias').textContent = advertenciasDocs.length;
                
                const faltasRef = firebaseApp.firestore.collection(firebaseApp.db, 'faltas');
                const faltasSnapshot = await firebaseApp.firestore.getDocs(faltasRef);
                let faltasDocs = faltasSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                let totalFaltas = 0;
                faltasDocs.forEach(item => {
                    totalFaltas += parseInt(item.quantidade) || 1;
                });
                
                document.getElementById('total-faltas').textContent = totalFaltas;
                
                const multasRef = firebaseApp.firestore.collection(firebaseApp.db, 'multas');
                const multasSnapshot = await firebaseApp.firestore.getDocs(multasRef);
                let multasDocs = multasSnapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                let totalMultas = 0;
                multasDocs.forEach(multa => {
                    totalMultas += parseFloat(multa.valor) || 0;
                });
                
                document.getElementById('total-multas').textContent = `R$ ${totalMultas.toFixed(2)}`;
                
                await updateTop5Advertencias();
                await updateTop5Danos();
                await updateTop5Faltas();
                await updateTop5Feedbacks();
                await updateTop5Multas();
                
                console.log(`Dashboard atualizado`);
            } catch (error) {
                console.error(`Erro ao atualizar dashboard: ${error.message}`);
            }
        }

        // Atualizar Top 5 - AdvertÃªncias
        async function updateTop5Advertencias() {
            try {
                const advertenciasRef = firebaseApp.firestore.collection(firebaseApp.db, 'advertencias');
                const snapshot = await firebaseApp.firestore.getDocs(advertenciasRef);
                let advertencias = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                const colaboradoresCount = {};
                const setoresCount = {};
                
                advertencias.forEach(adv => {
                    if (adv.colaborador) {
                        colaboradoresCount[adv.colaborador] = (colaboradoresCount[adv.colaborador] || 0) + 1;
                        
                        const colaboradorInfo = colaboradoresData.find(c => c.nome === adv.colaborador);
                        if (colaboradorInfo && colaboradorInfo.departamento) {
                            setoresCount[colaboradorInfo.departamento] = (setoresCount[colaboradorInfo.departamento] || 0) + 1;
                        }
                    }
                });
                
                const topColaboradores = Object.entries(colaboradoresCount)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 5);
                
                const topColaboradoresList = document.getElementById('top5-advertencias-colaboradores');
                if (topColaboradoresList) {
                    if (topColaboradores.length === 0) {
                        topColaboradoresList.innerHTML = '<li class="top5-empty">Nenhum registro encontrado</li>';
                    } else {
                        topColaboradoresList.innerHTML = '';
                        topColaboradores.forEach(([nome, count], index) => {
                            const li = document.createElement('li');
                            li.className = 'top5-item';
                            li.innerHTML = `
                                <span class="top5-name">${index + 1}. ${nome}</span>
                                <span class="top5-value">${count}</span>
                            `;
                            topColaboradoresList.appendChild(li);
                        });
                    }
                }
                
                const topSetores = Object.entries(setoresCount)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 5);
                
                const topSetoresList = document.getElementById('top5-advertencias-setores');
                if (topSetoresList) {
                    if (topSetores.length === 0) {
                        topSetoresList.innerHTML = '<li class="top5-empty">Nenhum registro encontrado</li>';
                    } else {
                        topSetoresList.innerHTML = '';
                        topSetores.forEach(([setor, count], index) => {
                            const li = document.createElement('li');
                            li.className = 'top5-item';
                            li.innerHTML = `
                                <span class="top5-name">${index + 1}. ${setor}</span>
                                <span class="top5-value">${count}</span>
                            `;
                            topSetoresList.appendChild(li);
                        });
                    }
                }
                
            } catch (error) {
                console.error(`Erro ao atualizar Top 5 AdvertÃªncias: ${error.message}`);
            }
        }

        // Atualizar Top 5 - Danos e Avarias
        async function updateTop5Danos() {
            try {
                const danosRef = firebaseApp.firestore.collection(firebaseApp.db, 'danos');
                const snapshot = await firebaseApp.firestore.getDocs(danosRef);
                let danos = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                const colaboradoresCount = {};
                const setoresCount = {};
                
                danos.forEach(dano => {
                    if (dano.colaborador) {
                        colaboradoresCount[dano.colaborador] = (colaboradoresCount[dano.colaborador] || 0) + 1;
                        
                        const colaboradorInfo = colaboradoresData.find(c => c.nome === dano.colaborador);
                        if (colaboradorInfo && colaboradorInfo.departamento) {
                            setoresCount[colaboradorInfo.departamento] = (setoresCount[colaboradorInfo.departamento] || 0) + 1;
                        }
                    }
                });
                
                const topColaboradores = Object.entries(colaboradoresCount)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 5);
                
                const topColaboradoresList = document.getElementById('top5-danos-colaboradores');
                if (topColaboradoresList) {
                    if (topColaboradores.length === 0) {
                        topColaboradoresList.innerHTML = '<li class="top5-empty">Nenhum registro encontrado</li>';
                    } else {
                        topColaboradoresList.innerHTML = '';
                        topColaboradores.forEach(([nome, count], index) => {
                            const li = document.createElement('li');
                            li.className = 'top5-item';
                            li.innerHTML = `
                                <span class="top5-name">${index + 1}. ${nome}</span>
                                <span class="top5-value">${count}</span>
                            `;
                            topColaboradoresList.appendChild(li);
                        });
                    }
                }
                
                const topSetores = Object.entries(setoresCount)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 5);
                
                const topSetoresList = document.getElementById('top5-danos-setores');
                if (topSetoresList) {
                    if (topSetores.length === 0) {
                        topSetoresList.innerHTML = '<li class="top5-empty">Nenhum registro encontrado</li>';
                    } else {
                        topSetoresList.innerHTML = '';
                        topSetores.forEach(([setor, count], index) => {
                            const li = document.createElement('li');
                            li.className = 'top5-item';
                            li.innerHTML = `
                                <span class="top5-name">${index + 1}. ${setor}</span>
                                <span class="top5-value">${count}</span>
                            `;
                            topSetoresList.appendChild(li);
                        });
                    }
                }
                
            } catch (error) {
                console.error(`Erro ao atualizar Top 5 Danos: ${error.message}`);
            }
        }

        // Atualizar Top 5 - Faltas
        async function updateTop5Faltas() {
            try {
                const faltasRef = firebaseApp.firestore.collection(firebaseApp.db, 'faltas');
                const snapshot = await firebaseApp.firestore.getDocs(faltasRef);
                let faltas = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                const colaboradoresCount = {};
                const setoresCount = {};
                
                faltas.forEach(falta => {
                    if (falta.colaborador) {
                        const quantidade = parseInt(falta.quantidade) || 1;
                        colaboradoresCount[falta.colaborador] = (colaboradoresCount[falta.colaborador] || 0) + quantidade;
                        
                        const colaboradorInfo = colaboradoresData.find(c => c.nome === falta.colaborador);
                        if (colaboradorInfo && colaboradorInfo.departamento) {
                            setoresCount[colaboradorInfo.departamento] = (setoresCount[colaboradorInfo.departamento] || 0) + quantidade;
                        }
                    }
                });
                
                const topColaboradores = Object.entries(colaboradoresCount)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 5);
                
                const topColaboradoresList = document.getElementById('top5-faltas-colaboradores');
                if (topColaboradoresList) {
                    if (topColaboradores.length === 0) {
                        topColaboradoresList.innerHTML = '<li class="top5-empty">Nenhum registro encontrado</li>';
                    } else {
                        topColaboradoresList.innerHTML = '';
                        topColaboradores.forEach(([nome, count], index) => {
                            const li = document.createElement('li');
                            li.className = 'top5-item';
                            li.innerHTML = `
                                <span class="top5-name">${index + 1}. ${nome}</span>
                                <span class="top5-value">${count}</span>
                            `;
                            topColaboradoresList.appendChild(li);
                        });
                    }
                }
                
                const topSetores = Object.entries(setoresCount)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 5);
                
                const topSetoresList = document.getElementById('top5-faltas-setores');
                if (topSetoresList) {
                    if (topSetores.length === 0) {
                        topSetoresList.innerHTML = '<li class="top5-empty">Nenhum registro encontrado</li>';
                    } else {
                        topSetoresList.innerHTML = '';
                        topSetores.forEach(([setor, count], index) => {
                            const li = document.createElement('li');
                            li.className = 'top5-item';
                            li.innerHTML = `
                                <span class="top5-name">${index + 1}. ${setor}</span>
                                <span class="top5-value">${count}</span>
                            `;
                            topSetoresList.appendChild(li);
                        });
                    }
                }
                
            } catch (error) {
                console.error(`Erro ao atualizar Top 5 Faltas: ${error.message}`);
            }
        }

        // Atualizar Top 5 - Feedbacks por Setor
        async function updateTop5Feedbacks() {
            try {
                const feedbacksRef = firebaseApp.firestore.collection(firebaseApp.db, 'feedbacks');
                const snapshot = await firebaseApp.firestore.getDocs(feedbacksRef);
                let feedbacks = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                const deptTotal = {};
                const deptPositivos = {};
                const deptNeutros = {};
                const deptMelhorar = {};
                
                feedbacks.forEach(feedback => {
                    if (feedback.departamento) {
                        deptTotal[feedback.departamento] = (deptTotal[feedback.departamento] || 0) + 
                            (parseInt(feedback.positivos) || 0) + 
                            (parseInt(feedback.neutros) || 0) + 
                            (parseInt(feedback.melhorar) || 0);
                        
                        deptPositivos[feedback.departamento] = (deptPositivos[feedback.departamento] || 0) + 
                            (parseInt(feedback.positivos) || 0);
                        
                        deptNeutros[feedback.departamento] = (deptNeutros[feedback.departamento] || 0) + 
                            (parseInt(feedback.neutros) || 0);
                        
                        deptMelhorar[feedback.departamento] = (deptMelhorar[feedback.departamento] || 0) + 
                            (parseInt(feedback.melhorar) || 0);
                    }
                });
                
                const topTotal = Object.entries(deptTotal)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 5);
                
                const topTotalList = document.getElementById('top5-feedbacks-total');
                if (topTotalList) {
                    if (topTotal.length === 0) {
                        topTotalList.innerHTML = '<li class="top5-empty">Nenhum registro encontrado</li>';
                    } else {
                        topTotalList.innerHTML = '';
                        topTotal.forEach(([setor, count], index) => {
                            const li = document.createElement('li');
                            li.className = 'top5-item';
                            li.innerHTML = `
                                <span class="top5-name">${index + 1}. ${setor}</span>
                                <span class="top5-value">${count}</span>
                            `;
                            topTotalList.appendChild(li);
                        });
                    }
                }
                
                const topPositivos = Object.entries(deptPositivos)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 5);
                
                const topPositivosList = document.getElementById('top5-feedbacks-positivos');
                if (topPositivosList) {
                    if (topPositivos.length === 0) {
                        topPositivosList.innerHTML = '<li class="top5-empty">Nenhum registro encontrado</li>';
                    } else {
                        topPositivosList.innerHTML = '';
                        topPositivos.forEach(([setor, count], index) => {
                            const li = document.createElement('li');
                            li.className = 'top5-item';
                            li.innerHTML = `
                                <span class="top5-name">${index + 1}. ${setor}</span>
                                <span class="top5-value">${count}</span>
                            `;
                            topPositivosList.appendChild(li);
                        });
                    }
                }
                
                const topNeutros = Object.entries(deptNeutros)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 5);
                
                const topNeutrosList = document.getElementById('top5-feedbacks-neutros');
                if (topNeutrosList) {
                    if (topNeutros.length === 0) {
                        topNeutrosList.innerHTML = '<li class="top5-empty">Nenhum registro encontrado</li>';
                    } else {
                        topNeutrosList.innerHTML = '';
                        topNeutros.forEach(([setor, count], index) => {
                            const li = document.createElement('li');
                            li.className = 'top5-item';
                            li.innerHTML = `
                                <span class="top5-name">${index + 1}. ${setor}</span>
                                <span class="top5-value" style="background-color: var(--orange-color);">${count}</span>
                            `;
                            topNeutrosList.appendChild(li);
                        });
                    }
                }
                
                const topMelhorar = Object.entries(deptMelhorar)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 5);
                
                const topMelhorarList = document.getElementById('top5-feedbacks-melhorar');
                if (topMelhorarList) {
                    if (topMelhorar.length === 0) {
                        topMelhorarList.innerHTML = '<li class="top5-empty">Nenhum registro encontrado</li>';
                    } else {
                        topMelhorarList.innerHTML = '';
                        topMelhorar.forEach(([setor, count], index) => {
                            const li = document.createElement('li');
                            li.className = 'top5-item';
                            li.innerHTML = `
                                <span class="top5-name">${index + 1}. ${setor}</span>
                                <span class="top5-value" style="background-color: var(--red-color);">${count}</span>
                            `;
                            topMelhorarList.appendChild(li);
                        });
                    }
                }
                
            } catch (error) {
                console.error(`Erro ao atualizar Top 5 Feedbacks: ${error.message}`);
            }
        }

        // Atualizar Top 5 - Multas (CORRIGIDO: por quantidade, nÃ£o por valor)
        async function updateTop5Multas() {
            try {
                const multasRef = firebaseApp.firestore.collection(firebaseApp.db, 'multas');
                const snapshot = await firebaseApp.firestore.getDocs(multasRef);
                let multas = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                const colaboradoresCount = {};
                const setoresCount = {};
                
                multas.forEach(multa => {
                    if (multa.colaborador) {
                        // Contar por quantidade, nÃ£o por valor
                        colaboradoresCount[multa.colaborador] = (colaboradoresCount[multa.colaborador] || 0) + 1;
                        
                        const colaboradorInfo = colaboradoresData.find(c => c.nome === multa.colaborador);
                        if (colaboradorInfo && colaboradorInfo.departamento) {
                            setoresCount[colaboradorInfo.departamento] = (setoresCount[colaboradorInfo.departamento] || 0) + 1;
                        }
                    }
                });
                
                const topColaboradores = Object.entries(colaboradoresCount)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 5);
                
                const topColaboradoresList = document.getElementById('top5-multas-colaboradores');
                if (topColaboradoresList) {
                    if (topColaboradores.length === 0) {
                        topColaboradoresList.innerHTML = '<li class="top5-empty">Nenhum registro encontrado</li>';
                    } else {
                        topColaboradoresList.innerHTML = '';
                        topColaboradores.forEach(([nome, count], index) => {
                            const li = document.createElement('li');
                            li.className = 'top5-item';
                            li.innerHTML = `
                                <span class="top5-name">${index + 1}. ${nome}</span>
                                <span class="top5-value">${count} multa(s)</span>
                            `;
                            topColaboradoresList.appendChild(li);
                        });
                    }
                }
                
                const topSetores = Object.entries(setoresCount)
                    .sort((a, b) => b[1] - a[1])
                    .slice(0, 5);
                
                const topSetoresList = document.getElementById('top5-multas-setores');
                if (topSetoresList) {
                    if (topSetores.length === 0) {
                        topSetoresList.innerHTML = '<li class="top5-empty">Nenhum registro encontrado</li>';
                    } else {
                        topSetoresList.innerHTML = '';
                        topSetores.forEach(([setor, count], index) => {
                            const li = document.createElement('li');
                            li.className = 'top5-item';
                            li.innerHTML = `
                                <span class="top5-name">${index + 1}. ${setor}</span>
                                <span class="top5-value">${count} multa(s)</span>
                            `;
                            topSetoresList.appendChild(li);
                        });
                    }
                }
                
            } catch (error) {
                console.error(`Erro ao atualizar Top 5 Multas: ${error.message}`);
            }
        }

        // Atualizar estatÃ­sticas de multas
        async function updateMultasStats() {
            try {
                const multasRef = firebaseApp.firestore.collection(firebaseApp.db, 'multas');
                const snapshot = await firebaseApp.firestore.getDocs(multasRef);
                let multas = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                let totalRegistros = multas.length;
                let valorTotal = 0;
                
                multas.forEach(multa => {
                    valorTotal += parseFloat(multa.valor) || 0;
                });
                
                const statMultasTotal = document.getElementById('stat-multas-total');
                const statValorTotal = document.getElementById('stat-valor-total');
                
                if (statMultasTotal) statMultasTotal.textContent = totalRegistros;
                if (statValorTotal) statValorTotal.textContent = `R$ ${valorTotal.toFixed(2)}`;
                
            } catch (error) {
                console.error(`Erro ao atualizar estatÃ­sticas de multas: ${error.message}`);
            }
        }

        // Carregar dados da tabela com ordenaÃ§Ã£o especÃ­fica
        async function loadTableData(section, filters = null) {
            const tableBody = document.getElementById(`${section}-table-body`);
            if (!tableBody) return;
            
            try {
                tableBody.innerHTML = '<tr><td colspan="11" class="loading"><div class="loading-spinner"></div></td></tr>';
                
                const collectionName = collections[section];
                let query = firebaseApp.firestore.collection(firebaseApp.db, collectionName);
                
                const snapshot = await firebaseApp.firestore.getDocs(query);
                
                console.log(`${section}: ${snapshot.size} documentos carregados`);
                updateCache(section, snapshot);
                
                const docs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                
                if (section === 'colaboradores') {
                    const filteredDocs = applyColaboradoresFilters(docs);
                    updateTableFromSnapshot(section, snapshot, filteredDocs);
                } else if (section === 'advertencias') {
                    const filteredDocs = applyAdvertenciasFilters(docs);
                    updateTableFromSnapshot(section, snapshot, filteredDocs);
                } else if (section === 'faltas') {
                    const filteredDocs = applyFaltasFilters(docs);
                    updateTableFromSnapshot(section, snapshot, filteredDocs);
                    updateFaltasStats(filteredDocs);
                } else if (section === 'danos') {
                    const filteredDocs = applyDanosFilters(docs);
                    updateTableFromSnapshot(section, snapshot, filteredDocs);
                    updateDanosStats(filteredDocs);
                } else if (section === 'feedbacks') {
                    const filteredDocs = applyFeedbacksFilters(docs);
                    updateTableFromSnapshot(section, snapshot, filteredDocs);
                    updateFeedbackStats(filteredDocs, false);
                } else if (section === 'multas') {
                    const filteredDocs = applyMultasFilters(docs);
                    updateTableFromSnapshot(section, snapshot, filteredDocs);
                    updateMultasStats();
                } else if (section === 'turnover') {
                    turnoverData = docs.sort((a, b) => b.mesAno.localeCompare(a.mesAno));
                    updateTableFromSnapshot(section, snapshot, turnoverData);
                    updateTurnoverTaxaAtual();
                } else {
                    updateTableFromSnapshot(section, snapshot);
                }
                
            } catch (error) {
                console.error(`Erro ao carregar ${section}: ${error.message}`);
                const tableBody = document.getElementById(`${section}-table-body`);
                if (tableBody) {
                    tableBody.innerHTML = `<tr><td colspan="11">Erro: ${error.message}</td></tr>`;
                }
            }
        }

        // Atualizar tabela com snapshot
        function updateTableFromSnapshot(section, snapshot, filteredDocs = null) {
            const tableBody = document.getElementById(`${section}-table-body`);
            if (!tableBody) return;
            
            let docs = filteredDocs;
            if (!docs) {
                docs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
            }
            
            if (docs.length === 0) {
                const cols = getColumnCount(section);
                tableBody.innerHTML = `<tr><td colspan="${cols}">Nenhum registro encontrado com os filtros aplicados.</td></tr>`;
                return;
            }
            
            tableBody.innerHTML = '';
            
            if (section === 'colaboradores') {
                docs.sort((a, b) => (a.nome || '').localeCompare(b.nome || ''));
            } else if (section === 'empresas') {
                docs.sort((a, b) => (a.nome || '').localeCompare(b.nome || ''));
            } else if (section === 'departamentos') {
                docs.sort((a, b) => (a.nome || '').localeCompare(b.nome || ''));
            } else if (section === 'tiposMulta') {
                docs.sort((a, b) => (a.nome || '').localeCompare(b.nome || ''));
            } else if (section === 'advertencias' || section === 'multas') {
                docs.sort((a, b) => {
                    const dataA = parseDateExactly(a.data) || new Date(0);
                    const dataB = parseDateExactly(b.data) || new Date(0);
                    return dataB - dataA;
                });
            } else if (section === 'faltas') {
                docs.sort((a, b) => {
                    const dataA = parseDateExactly(a.dataInicio) || new Date(0);
                    const dataB = parseDateExactly(b.dataInicio) || new Date(0);
                    return dataB - dataA;
                });
            } else if (section === 'danos') {
                docs.sort((a, b) => {
                    const dataA = parseDateExactly(a.data) || new Date(0);
                    const dataB = parseDateExactly(b.data) || new Date(0);
                    return dataB - dataA;
                });
            } else if (section === 'feedbacks') {
                docs.sort((a, b) => {
                    if (!a.mesAno) return 1;
                    if (!b.mesAno) return -1;
                    return b.mesAno.localeCompare(a.mesAno);
                });
            } else if (section === 'turnover') {
                docs.sort((a, b) => b.mesAno.localeCompare(a.mesAno));
            }
            
            docs.forEach((data) => {
                const row = document.createElement('tr');
                
                if (section === 'turnover') {
                    const taxa = data.taxaTurnover || calcularTaxaTurnover(
                        data.colaboradoresInicio,
                        data.admissoes,
                        data.desligamentos,
                        data.colaboradoresFim
                    );
                    
                    const classificacao = classificarTurnover(taxa);
                    
                    const mesAno = data.mesAno || '';
                    let mesAnoFormatado = mesAno;
                    if (mesAno.includes('-')) {
                        const [ano, mes] = mesAno.split('-');
                        const meses = ['Janeiro', 'Fevereiro', 'MarÃ§o', 'Abril', 'Maio', 'Junho', 
                                      'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
                        const mesNome = meses[parseInt(mes) - 1] || mes;
                        mesAnoFormatado = `${mesNome}/${ano}`;
                    }
                    
                    const status = (data.colaboradoresInicio && data.colaboradoresFim) ? 
                        '<span class="status status-active">Completo</span>' : 
                        '<span class="status status-warning">Pendente</span>';
                    
                    row.innerHTML = `
                        <td><strong>${mesAnoFormatado}</strong></td>
                        <td>${data.colaboradoresInicio || '-'}</td>
                        <td>${data.admissoes || '0'}</td>
                        <td>${data.desligamentos || '0'}</td>
                        <td>${data.colaboradoresFim || '-'}</td>
                        <td><strong>${taxa}%</strong></td>
                        <td><span class="status ${classificacao.classe}"><i class="fas ${classificacao.icone}" style="margin-right: 5px;"></i>${classificacao.texto}</span></td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn edit-btn" onclick="editItem('${section}', '${data.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn delete-btn" onclick="deleteItem('${section}', '${data.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                } else if (section === 'empresas') {
                    row.innerHTML = `
                        <td><strong>${data.nome || 'Sem nome'}</strong></td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn edit-btn" onclick="editItem('${section}', '${data.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn delete-btn" onclick="deleteItem('${section}', '${data.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                } else if (section === 'departamentos') {
                    row.innerHTML = `
                        <td><strong>${data.nome || 'Sem nome'}</strong></td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn edit-btn" onclick="editItem('${section}', '${data.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn delete-btn" onclick="deleteItem('${section}', '${data.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                } else if (section === 'colaboradores') {
                    row.innerHTML = `
                        <td><strong>${data.nome || 'Sem nome'}</strong></td>
                        <td>${data.departamento || 'NÃ£o especificado'}</td>
                        <td>${data.empresa || 'NÃ£o especificada'}</td>
                        <td>${formatDateExactly(data.dataAdmissao) || 'NÃ£o especificada'}</td>
                        <td><span class="status ${data.status === 'Ativo' ? 'status-active' : 'status-inactive'}">${data.status || 'N/A'}</span></td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn edit-btn" onclick="editItem('${section}', '${data.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn delete-btn" onclick="deleteItem('${section}', '${data.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                } else if (section === 'advertencias') {
                    const colaboradorInfo = colaboradoresData.find(c => c.nome === data.colaborador);
                    const departamento = colaboradorInfo ? colaboradorInfo.departamento : 'NÃ£o especificado';
                    
                    row.innerHTML = `
                        <td>${data.colaborador || 'NÃ£o especificado'}</td>
                        <td>${departamento}</td>
                        <td>${formatDateExactly(data.data) || 'NÃ£o especificada'}</td>
                        <td>${data.motivo || 'NÃ£o especificado'}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn edit-btn" onclick="editItem('${section}', '${data.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn delete-btn" onclick="deleteItem('${section}', '${data.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                } else if (section === 'danos') {
                    const colaboradorInfo = colaboradoresData.find(c => c.nome === data.colaborador);
                    const departamento = colaboradorInfo ? colaboradorInfo.departamento : 'NÃ£o especificado';
                    
                    row.innerHTML = `
                        <td>${data.colaborador || 'NÃ£o especificado'}</td>
                        <td>${departamento}</td>
                        <td>${formatDateExactly(data.data) || 'NÃ£o especificada'}</td>
                        <td>${data.motivo || 'NÃ£o especificado'}</td>
                        <td><strong>R$ ${parseFloat(data.valor || 0).toFixed(2)}</strong></td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn edit-btn" onclick="editItem('${section}', '${data.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn delete-btn" onclick="deleteItem('${section}', '${data.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                } else if (section === 'faltas') {
                    const colaboradorInfo = colaboradoresData.find(c => c.nome === data.colaborador);
                    const departamento = colaboradorInfo ? colaboradorInfo.departamento : 'NÃ£o especificado';
                    
                    let periodo = `${formatDateExactly(data.dataInicio)}`;
                    if (data.dataFim && data.dataFim !== data.dataInicio) {
                        periodo += ` atÃ© ${formatDateExactly(data.dataFim)}`;
                    }
                    
                    row.innerHTML = `
                        <td>${data.colaborador || 'NÃ£o especificado'}</td>
                        <td>${departamento}</td>
                        <td><strong>${formatDateExactly(data.dataInicio)}</strong></td>
                        <td>${periodo}</td>
                        <td><span class="status status-warning">${data.quantidade || 1} dia(s)</span></td>
                        <td>${data.justificativa ? (data.justificativa.substring(0, 30) + '...') : 'Nenhuma'}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn edit-btn" onclick="editItem('${section}', '${data.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn delete-btn" onclick="deleteItem('${section}', '${data.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                } else if (section === 'feedbacks') {
                    const mesAno = data.mesAno || '';
                    let mesAnoFormatado = mesAno;
                    if (mesAno.includes('-')) {
                        const [ano, mes] = mesAno.split('-');
                        const meses = ['Janeiro', 'Fevereiro', 'MarÃ§o', 'Abril', 'Maio', 'Junho', 
                                      'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
                        const mesNome = meses[parseInt(mes) - 1] || mes;
                        mesAnoFormatado = `${mesNome}/${ano}`;
                    }
                    const total = (parseInt(data.positivos || 0) + parseInt(data.neutros || 0) + parseInt(data.melhorar || 0));
                    
                    row.innerHTML = `
                        <td><strong>${mesAnoFormatado}</strong></td>
                        <td>${data.departamento || 'NÃ£o especificado'}</td>
                        <td><span class="badge badge-positivo">${data.positivos || 0}</span></td>
                        <td><span class="badge badge-neutro">${data.neutros || 0}</span></td>
                        <td><span class="badge badge-melhorar">${data.melhorar || 0}</span></td>
                        <td><strong>${total}</strong></td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn edit-btn" onclick="editItem('${section}', '${data.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn delete-btn" onclick="deleteItem('${section}', '${data.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                } else if (section === 'tiposMulta') {
                    row.innerHTML = `
                        <td><strong>${data.nome || 'Sem nome'}</strong></td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn edit-btn" onclick="editItem('${section}', '${data.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn delete-btn" onclick="deleteItem('${section}', '${data.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                } else if (section === 'multas') {
                    const colaboradorInfo = colaboradoresData.find(c => c.nome === data.colaborador);
                    const departamento = colaboradorInfo ? colaboradorInfo.departamento : 'NÃ£o especificado';
                    
                    let dataHora = formatDateExactly(data.data);
                    if (data.hora) {
                        dataHora += ` ${data.hora}`;
                    }
                    
                    row.innerHTML = `
                        <td>${data.colaborador || 'NÃ£o especificado'}</td>
                        <td>${departamento}</td>
                        <td>${dataHora}</td>
                        <td>${data.tipo || 'NÃ£o especificado'}</td>
                        <td>${data.placa || 'NÃ£o informada'}</td>
                        <td>${data.ait || 'NÃ£o informado'}</td>
                        <td>${data.local || 'NÃ£o informado'}${data.municipio ? ` - ${data.municipio}` : ''}</td>
                        <td><strong>R$ ${parseFloat(data.valor || 0).toFixed(2)}</strong></td>
                        <td>
                            <span class="status ${getStatusClass(data.status)}">
                                ${data.status || 'Pendente'}
                            </span>
                        </td>
                        <td>${formatDateExactly(data.dataLimiteIndicacao) || 'NÃ£o informada'}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="action-btn" style="background-color: var(--success-color);" 
                                        onclick="avancarStatusMulta('${data.id}')" title="AvanÃ§ar Status">
                                    <i class="fas fa-arrow-right"></i>
                                </button>
                                <button class="action-btn edit-btn" onclick="editItem('${section}', '${data.id}')">
                                    <i class="fas fa-edit"></i>
                                </button>
                                <button class="action-btn delete-btn" onclick="deleteItem('${section}', '${data.id}')">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </td>
                    `;
                }
                
                tableBody.appendChild(row);
            });
        }

        function getStatusClass(status) {
            const statusClasses = {
                'Colaborador ciente': 'status-info',
                'Aguardando CNH': 'status-warning',
                'IndicaÃ§Ã£o realizada': 'status-info',
                'IndicaÃ§Ã£o aceita': 'status-info',
                'Aguardando penalidade': 'status-warning',
                'Desconto Realizado': 'status-active',
                'Processo finalizado': 'status-active',
                'Aguardando recurso': 'status-warning'
            };
            return statusClasses[status] || 'status-warning';
        }

        function getColumnCount(section) {
            const columns = {
                empresas: 2,
                departamentos: 2,
                colaboradores: 6,
                advertencias: 5,
                danos: 6,
                faltas: 7,
                feedbacks: 7,
                tiposMulta: 2,
                multas: 11,
                turnover: 8
            };
            return columns[section] || 5;
        }

        window.avancarStatusMulta = async function(id) {
            const statusFlow = [
                'Colaborador ciente',
                'Aguardando CNH',
                'IndicaÃ§Ã£o realizada',
                'IndicaÃ§Ã£o aceita',
                'Aguardando penalidade',
                'Desconto Realizado',
                'Processo finalizado'
            ];
            
            try {
                const docRef = firebaseApp.firestore.doc(firebaseApp.db, 'multas', id);
                const docSnap = await firebaseApp.firestore.getDocs(
                    firebaseApp.firestore.query(firebaseApp.firestore.collection(firebaseApp.db, 'multas'))
                );
                
                const multaDoc = docSnap.docs.find(d => d.id === id);
                if (multaDoc) {
                    const multa = multaDoc.data();
                    const currentIndex = statusFlow.indexOf(multa.status);
                    
                    if (currentIndex < statusFlow.length - 1) {
                        const nextStatus = statusFlow[currentIndex + 1];
                        await firebaseApp.firestore.updateDoc(docRef, {
                            status: nextStatus,
                            updatedAt: new Date().toISOString()
                        });
                        showAlert(`Status avanÃ§ado para: ${nextStatus}`, 'success', 'multas-alert');
                    } else {
                        showAlert('Processo jÃ¡ estÃ¡ finalizado!', 'warning', 'multas-alert');
                    }
                }
            } catch (error) {
                console.error(`Erro ao avanÃ§ar status: ${error.message}`);
                showAlert(`Erro ao avanÃ§ar status: ${error.message}`, 'error', 'multas-alert');
            }
        };

        // FunÃ§Ã£o corrigida para atualizar estatÃ­sticas de feedbacks
        function updateFeedbackStats(feedbacks, isInitialLoad = false) {
            if (!feedbacks || feedbacks.length === 0) {
                document.getElementById('stat-positivos').textContent = '0';
                document.getElementById('stat-neutros').textContent = '0';
                document.getElementById('stat-melhorar').textContent = '0';
                document.getElementById('stat-total-feedbacks').textContent = '0';
                return;
            }
            
            let filteredFeedbacks = [...feedbacks];
            let subtitleText = 'Total geral';
            
            const temFiltroMes = feedbacksFiltroAtual && feedbacksFiltroAtual.mesAno && feedbacksFiltroAtual.mesAno !== '';
            const temFiltroDepartamento = feedbacksFiltroAtual && feedbacksFiltroAtual.departamento && feedbacksFiltroAtual.departamento !== '';
            
            if (temFiltroMes) {
                filteredFeedbacks = filteredFeedbacks.filter(f => f.mesAno === feedbacksFiltroAtual.mesAno);
                subtitleText = `MÃªs: ${formatarMesAno(feedbacksFiltroAtual.mesAno)}`;
            }
            
            if (temFiltroDepartamento) {
                filteredFeedbacks = filteredFeedbacks.filter(f => f.departamento === feedbacksFiltroAtual.departamento);
                if (temFiltroMes) {
                    subtitleText = `${feedbacksFiltroAtual.departamento} - ${formatarMesAno(feedbacksFiltroAtual.mesAno)}`;
                } else {
                    subtitleText = `Departamento: ${feedbacksFiltroAtual.departamento}`;
                }
            }
            
            if (!temFiltroMes && !temFiltroDepartamento) {
                filteredFeedbacks = feedbacks;
                subtitleText = 'Total geral';
            }
            
            let positivos = 0;
            let neutros = 0;
            let melhorar = 0;
            let total = 0;
            
            filteredFeedbacks.forEach(feedback => {
                const p = parseInt(feedback.positivos) || 0;
                const n = parseInt(feedback.neutros) || 0;
                const m = parseInt(feedback.melhorar) || 0;
                
                positivos += p;
                neutros += n;
                melhorar += m;
                total += (p + n + m);
            });
            
            const statPositivos = document.getElementById('stat-positivos');
            const statNeutros = document.getElementById('stat-neutros');
            const statMelhorar = document.getElementById('stat-melhorar');
            const statTotal = document.getElementById('stat-total-feedbacks');
            const statPositivosSubtitle = document.getElementById('stat-positivos-subtitle');
            const statNeutrosSubtitle = document.getElementById('stat-neutros-subtitle');
            const statMelhorarSubtitle = document.getElementById('stat-melhorar-subtitle');
            const statTotalSubtitle = document.getElementById('stat-total-subtitle');
            
            if (statPositivos) statPositivos.textContent = positivos;
            if (statNeutros) statNeutros.textContent = neutros;
            if (statMelhorar) statMelhorar.textContent = melhorar;
            if (statTotal) statTotal.textContent = total;
            
            if (statPositivosSubtitle) statPositivosSubtitle.textContent = subtitleText;
            if (statNeutrosSubtitle) statNeutrosSubtitle.textContent = subtitleText;
            if (statMelhorarSubtitle) statMelhorarSubtitle.textContent = subtitleText;
            if (statTotalSubtitle) statTotalSubtitle.textContent = subtitleText;
            
            console.log(`ðŸ“Š Feedbacks atualizados: ${subtitleText} - Positivos=${positivos}, Neutros=${neutros}, Melhorar=${melhorar}, Total=${total}`);
        }

        function formatarMesAno(mesAno) {
            if (!mesAno) return '';
            const [ano, mes] = mesAno.split('-');
            const meses = ['Janeiro', 'Fevereiro', 'MarÃ§o', 'Abril', 'Maio', 'Junho', 
                          'Julho', 'Agosto', 'Setembro', 'Outubro', 'Novembro', 'Dezembro'];
            const mesNome = meses[parseInt(mes) - 1] || mes;
            return `${mesNome}/${ano}`;
        }

        // Filtros
        let colaboradoresFiltroAtual = {
            status: 'Ativo',
            nome: '',
            departamento: '',
            empresa: ''
        };
        
        let advertenciasFiltroAtual = {
            nome: '',
            departamento: '',
            dataInicio: '',
            dataFim: ''
        };
        
        let faltasFiltroAtual = {
            nome: '',
            departamento: '',
            dataInicio: '',
            dataFim: ''
        };
        
        let danosFiltroAtual = {
            nome: '',
            departamento: '',
            dataInicio: '',
            dataFim: ''
        };
        
        let feedbacksFiltroAtual = {
            mesAno: '',
            departamento: ''
        };
        
        let multasFiltroAtual = {
            nome: '',
            departamento: '',
            status: '',
            placa: '',
            ait: '',
            dataInicio: '',
            dataFim: ''
        };

        function applyColaboradoresFilters(docs) {
            let filtered = [...docs];
            
            if (colaboradoresFiltroAtual.status && colaboradoresFiltroAtual.status !== 'todos') {
                filtered = filtered.filter(item => item.status === colaboradoresFiltroAtual.status);
            }
            
            if (colaboradoresFiltroAtual.nome) {
                const termo = colaboradoresFiltroAtual.nome.toLowerCase();
                filtered = filtered.filter(item => 
                    item.nome && item.nome.toLowerCase().includes(termo)
                );
            }
            
            if (colaboradoresFiltroAtual.departamento) {
                filtered = filtered.filter(item => 
                    item.departamento === colaboradoresFiltroAtual.departamento
                );
            }
            
            if (colaboradoresFiltroAtual.empresa) {
                filtered = filtered.filter(item => 
                    item.empresa === colaboradoresFiltroAtual.empresa
                );
            }
            
            return filtered;
        }

        function applyAdvertenciasFilters(docs) {
            let filtered = [...docs];
            
            if (advertenciasFiltroAtual.nome) {
                const termo = advertenciasFiltroAtual.nome.toLowerCase();
                filtered = filtered.filter(item => 
                    item.colaborador && item.colaborador.toLowerCase().includes(termo)
                );
            }
            
            if (advertenciasFiltroAtual.departamento) {
                filtered = filtered.filter(item => {
                    const colaboradorInfo = colaboradoresData.find(c => c.nome === item.colaborador);
                    return colaboradorInfo && colaboradorInfo.departamento === advertenciasFiltroAtual.departamento;
                });
            }
            
            if (advertenciasFiltroAtual.dataInicio || advertenciasFiltroAtual.dataFim) {
                filtered = filtered.filter(item => {
                    return dataEstaNoIntervalo(item.data, advertenciasFiltroAtual.dataInicio, advertenciasFiltroAtual.dataFim);
                });
            }
            
            return filtered;
        }

        function applyFaltasFilters(docs) {
            let filtered = [...docs];
            
            if (faltasFiltroAtual.nome) {
                const termo = faltasFiltroAtual.nome.toLowerCase();
                filtered = filtered.filter(item => 
                    item.colaborador && item.colaborador.toLowerCase().includes(termo)
                );
            }
            
            if (faltasFiltroAtual.departamento) {
                filtered = filtered.filter(item => {
                    const colaboradorInfo = colaboradoresData.find(c => c.nome === item.colaborador);
                    return colaboradorInfo && colaboradorInfo.departamento === faltasFiltroAtual.departamento;
                });
            }
            
            if (faltasFiltroAtual.dataInicio || faltasFiltroAtual.dataFim) {
                filtered = filtered.filter(item => {
                    const noIntervalo = dataEstaNoIntervalo(item.dataInicio, faltasFiltroAtual.dataInicio, faltasFiltroAtual.dataFim) ||
                                       dataEstaNoIntervalo(item.dataFim, faltasFiltroAtual.dataInicio, faltasFiltroAtual.dataFim);
                    return noIntervalo;
                });
            }
            
            return filtered;
        }

        function applyDanosFilters(docs) {
            let filtered = [...docs];
            
            if (danosFiltroAtual.nome) {
                const termo = danosFiltroAtual.nome.toLowerCase();
                filtered = filtered.filter(item => 
                    item.colaborador && item.colaborador.toLowerCase().includes(termo)
                );
            }
            
            if (danosFiltroAtual.departamento) {
                filtered = filtered.filter(item => {
                    const colaboradorInfo = colaboradoresData.find(c => c.nome === item.colaborador);
                    return colaboradorInfo && colaboradorInfo.departamento === danosFiltroAtual.departamento;
                });
            }
            
            if (danosFiltroAtual.dataInicio || danosFiltroAtual.dataFim) {
                filtered = filtered.filter(item => {
                    return dataEstaNoIntervalo(item.data, danosFiltroAtual.dataInicio, danosFiltroAtual.dataFim);
                });
            }
            
            return filtered;
        }

        function applyFeedbacksFilters(docs) {
            let filtered = [...docs];
            
            if (feedbacksFiltroAtual && feedbacksFiltroAtual.mesAno) {
                filtered = filtered.filter(item => item.mesAno === feedbacksFiltroAtual.mesAno);
            }
            
            if (feedbacksFiltroAtual && feedbacksFiltroAtual.departamento) {
                filtered = filtered.filter(item => item.departamento === feedbacksFiltroAtual.departamento);
            }
            
            return filtered;
        }

        function applyMultasFilters(docs) {
            let filtered = [...docs];
            
            if (multasFiltroAtual.nome) {
                const termo = multasFiltroAtual.nome.toLowerCase();
                filtered = filtered.filter(item => 
                    item.colaborador && item.colaborador.toLowerCase().includes(termo)
                );
            }
            
            if (multasFiltroAtual.departamento) {
                filtered = filtered.filter(item => {
                    const colaboradorInfo = colaboradoresData.find(c => c.nome === item.colaborador);
                    return colaboradorInfo && colaboradorInfo.departamento === multasFiltroAtual.departamento;
                });
            }
            
            if (multasFiltroAtual.status) {
                filtered = filtered.filter(item => item.status === multasFiltroAtual.status);
            }
            
            if (multasFiltroAtual.placa) {
                const termo = multasFiltroAtual.placa.toLowerCase();
                filtered = filtered.filter(item => 
                    item.placa && item.placa.toLowerCase().includes(termo)
                );
            }
            
            if (multasFiltroAtual.ait) {
                const termo = multasFiltroAtual.ait.toLowerCase();
                filtered = filtered.filter(item => 
                    item.ait && item.ait.toLowerCase().includes(termo)
                );
            }
            
            if (multasFiltroAtual.dataInicio || multasFiltroAtual.dataFim) {
                filtered = filtered.filter(item => {
                    return dataEstaNoIntervalo(item.data, multasFiltroAtual.dataInicio, multasFiltroAtual.dataFim);
                });
            }
            
            return filtered;
        }

        // FunÃ§Ãµes de carregamento de formulÃ¡rios
        function loadEmpresaForm(mode = 'add', id = null) {
            let formHTML = `
                <div class="form-group" style="flex: 100%;">
                    <label for="nome">Nome da Empresa *</label>
                    <input type="text" id="nome" class="form-control" placeholder="Ex: Minha Empresa Ltda" required>
                </div>
            `;
            
            document.getElementById('modal-form').innerHTML = formHTML;
            
            if (mode === 'edit' && id) {
                fillFormWithData('empresas', id);
            }
        }

        function loadDepartamentoForm(mode = 'add', id = null) {
            let formHTML = `
                <div class="form-group" style="flex: 100%;">
                    <label for="nome">Nome do Departamento *</label>
                    <input type="text" id="nome" class="form-control" placeholder="Ex: Recursos Humanos" required>
                </div>
            `;
            
            document.getElementById('modal-form').innerHTML = formHTML;
            
            if (mode === 'edit' && id) {
                fillFormWithData('departamentos', id);
            }
        }

        function loadColaboradorForm(mode = 'add', id = null) {
            let formHTML = `
                <div class="form-row">
                    <div class="form-group">
                        <label for="nome">Nome Completo *</label>
                        <input type="text" id="nome" class="form-control" placeholder="Ex: JoÃ£o Silva" required>
                    </div>
                    <div class="form-group">
                        <label for="dataAdmissao">Data de AdmissÃ£o *</label>
                        <input type="date" id="dataAdmissao" class="form-control" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="departamento">Departamento *</label>
                        <select id="departamento" class="form-control" required>
                            <option value="">Selecione um departamento</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="empresa">Empresa *</label>
                        <select id="empresa" class="form-control" required>
                            <option value="">Selecione uma empresa</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="status">Status</label>
                        <select id="status" class="form-control">
                            <option value="Ativo">Ativo</option>
                            <option value="Inativo">Inativo</option>
                        </select>
                    </div>
                </div>
            `;
            
            document.getElementById('modal-form').innerHTML = formHTML;
            
            populateSelectOptions();
            
            if (mode === 'edit' && id) {
                fillFormWithData('colaboradores', id);
            }
        }

        function loadAdvertenciaForm(mode = 'add', id = null) {
            const hoje = new Date();
            const ano = hoje.getFullYear();
            const mes = String(hoje.getMonth() + 1).padStart(2, '0');
            const dia = String(hoje.getDate()).padStart(2, '0');
            const dataAtual = `${ano}-${mes}-${dia}`;
            
            let formHTML = `
                <div class="form-row">
                    <div class="form-group">
                        <label for="colaborador">Colaborador *</label>
                        <select id="colaborador" class="form-control" required>
                            <option value="">Selecione um colaborador</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="data">Data da AdvertÃªncia *</label>
                        <input type="date" id="data" class="form-control" value="${dataAtual}" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group" style="flex: 100%;">
                        <label for="motivo">Motivo da AdvertÃªncia *</label>
                        <input type="text" id="motivo" class="form-control" placeholder="Ex: Atraso frequente" required>
                    </div>
                </div>
            `;
            
            document.getElementById('modal-form').innerHTML = formHTML;
            
            const colaboradorSelect = document.getElementById('colaborador');
            if (colaboradorSelect) {
                colaboradorSelect.innerHTML = '<option value="">Selecione um colaborador</option>';
                colaboradoresData.forEach(colab => {
                    if (colab.nome && colab.status === 'Ativo') {
                        const option = document.createElement('option');
                        option.value = colab.nome;
                        option.textContent = colab.nome;
                        colaboradorSelect.appendChild(option);
                    }
                });
            }
            
            if (mode === 'edit' && id) {
                fillFormWithData('advertencias', id);
            }
        }

        function loadDanoForm(mode = 'add', id = null) {
            const hoje = new Date();
            const ano = hoje.getFullYear();
            const mes = String(hoje.getMonth() + 1).padStart(2, '0');
            const dia = String(hoje.getDate()).padStart(2, '0');
            const dataAtual = `${ano}-${mes}-${dia}`;
            
            let formHTML = `
                <div class="form-row">
                    <div class="form-group">
                        <label for="colaborador">Colaborador *</label>
                        <select id="colaborador" class="form-control" required>
                            <option value="">Selecione um colaborador</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="data">Data do Dano *</label>
                        <input type="date" id="data" class="form-control" value="${dataAtual}" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="motivo">Motivo *</label>
                        <select id="motivo" class="form-control" required>
                            <option value="">Selecione um motivo</option>
                            <option value="Perda de ferramenta">Perda de ferramenta</option>
                            <option value="Conserto do celular">Conserto do celular</option>
                            <option value="Perda de equipamento">Perda de equipamento</option>
                            <option value="Perda cartÃ£o sÃ³lides">Perda cartÃ£o sÃ³lides</option>
                            <option value="Conserto do carro">Conserto do carro</option>
                            <option value="Perda EPI">Perda EPI</option>
                            <option value="Outro">Outro</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="valor">Valor (R$) *</label>
                        <input type="number" id="valor" class="form-control" placeholder="0.00" step="0.01" min="0" required>
                    </div>
                </div>
                <div class="form-row" id="outro-motivo-container" style="display: none;">
                    <div class="form-group" style="flex: 100%;">
                        <label for="outroMotivo">Especificar outro motivo</label>
                        <input type="text" id="outroMotivo" class="form-control" placeholder="Digite o motivo...">
                    </div>
                </div>
            `;
            
            document.getElementById('modal-form').innerHTML = formHTML;
            
            const colaboradorSelect = document.getElementById('colaborador');
            if (colaboradorSelect) {
                colaboradorSelect.innerHTML = '<option value="">Selecione um colaborador</option>';
                colaboradoresData.forEach(colab => {
                    if (colab.nome && colab.status === 'Ativo') {
                        const option = document.createElement('option');
                        option.value = colab.nome;
                        option.textContent = colab.nome;
                        colaboradorSelect.appendChild(option);
                    }
                });
            }
            
            const motivoSelect = document.getElementById('motivo');
            if (motivoSelect) {
                motivoSelect.addEventListener('change', function() {
                    const outroContainer = document.getElementById('outro-motivo-container');
                    if (this.value === 'Outro') {
                        outroContainer.style.display = 'block';
                    } else {
                        outroContainer.style.display = 'none';
                        document.getElementById('outroMotivo').value = '';
                    }
                });
            }
            
            if (mode === 'edit' && id) {
                fillFormWithData('danos', id);
                
                setTimeout(() => {
                    const motivoSelect = document.getElementById('motivo');
                    const outroInput = document.getElementById('outroMotivo');
                    if (motivoSelect && outroInput && motivoSelect.value === 'Outro' && outroInput.value) {
                        document.getElementById('outro-motivo-container').style.display = 'block';
                    }
                }, 100);
            }
        }

        function loadFaltaForm(mode = 'add', id = null) {
            const hoje = new Date();
            const ano = hoje.getFullYear();
            const mes = String(hoje.getMonth() + 1).padStart(2, '0');
            const dia = String(hoje.getDate()).padStart(2, '0');
            const dataAtual = `${ano}-${mes}-${dia}`;
            
            let formHTML = `
                <div class="form-row">
                    <div class="form-group">
                        <label for="colaborador">Colaborador *</label>
                        <select id="colaborador" class="form-control" required>
                            <option value="">Selecione um colaborador</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="dataInicio">Data InÃ­cio da Falta *</label>
                        <input type="date" id="dataInicio" class="form-control" value="${dataAtual}" required>
                    </div>
                    <div class="form-group">
                        <label for="dataFim">Data Fim da Falta</label>
                        <input type="date" id="dataFim" class="form-control" value="${dataAtual}">
                        <small style="color: var(--gray-color);">Se for apenas um dia, deixe igual Ã  data inÃ­cio</small>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group" style="flex: 100%;">
                        <label for="quantidade">Quantidade de Dias *</label>
                        <input type="number" id="quantidade" class="form-control" value="1" min="1" readonly style="background-color: #f8f9fa;">
                        <small style="color: var(--gray-color);">Calculado automaticamente</small>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group" style="flex: 100%;">
                        <label for="justificativa">Justificativa</label>
                        <textarea id="justificativa" class="form-control" rows="4" placeholder="Descreva a justificativa da falta..."></textarea>
                    </div>
                </div>
            `;
            
            document.getElementById('modal-form').innerHTML = formHTML;
            
            const colaboradorSelect = document.getElementById('colaborador');
            if (colaboradorSelect) {
                colaboradorSelect.innerHTML = '<option value="">Selecione um colaborador</option>';
                
                if (colaboradoresData && colaboradoresData.length > 0) {
                    colaboradoresData.forEach(colab => {
                        if (colab.nome && colab.status === 'Ativo') {
                            const option = document.createElement('option');
                            option.value = colab.nome;
                            option.textContent = colab.nome;
                            colaboradorSelect.appendChild(option);
                        }
                    });
                }
            }
            
            const dataInicio = document.getElementById('dataInicio');
            const dataFim = document.getElementById('dataFim');
            const quantidade = document.getElementById('quantidade');
            
            function calcularQuantidade() {
                if (dataInicio.value && dataFim.value) {
                    const dias = calcularDiasEntreDatas(dataInicio.value, dataFim.value);
                    quantidade.value = dias;
                }
            }
            
            dataInicio.addEventListener('change', calcularQuantidade);
            dataFim.addEventListener('change', calcularQuantidade);
            
            if (mode === 'edit' && id) {
                fillFormWithData('faltas', id);
                
                setTimeout(() => {
                    calcularQuantidade();
                }, 200);
            }
        }

        function loadFeedbackForm(mode = 'add', id = null) {
            const hoje = new Date();
            const ano = hoje.getFullYear();
            const mes = String(hoje.getMonth() + 1).padStart(2, '0');
            const mesAnoAtual = `${ano}-${mes}`;
            
            let formHTML = `
                <div class="form-row">
                    <div class="form-group">
                        <label for="mesAno">MÃªs/Ano *</label>
                        <input type="month" id="mesAno" class="form-control" value="${mesAnoAtual}" required>
                    </div>
                    <div class="form-group">
                        <label for="departamento">Departamento *</label>
                        <select id="departamento" class="form-control" required>
                            <option value="">Selecione um departamento</option>
                        </select>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="positivos">Feedbacks Positivos *</label>
                        <input type="number" id="positivos" class="form-control" placeholder="0" min="0" value="0" required>
                    </div>
                    <div class="form-group">
                        <label for="neutros">Feedbacks Neutros *</label>
                        <input type="number" id="neutros" class="form-control" placeholder="0" min="0" value="0" required>
                    </div>
                    <div class="form-group">
                        <label for="melhorar">A Melhorar *</label>
                        <input type="number" id="melhorar" class="form-control" placeholder="0" min="0" value="0" required>
                    </div>
                </div>
            `;
            
            document.getElementById('modal-form').innerHTML = formHTML;
            
            const departamentoSelect = document.getElementById('departamento');
            if (departamentoSelect) {
                departamentoSelect.innerHTML = '<option value="">Selecione um departamento</option>';
                departamentosData.sort((a, b) => (a.nome || '').localeCompare(b.nome || '')).forEach(depto => {
                    if (depto.nome) {
                        const option = document.createElement('option');
                        option.value = depto.nome;
                        option.textContent = depto.nome;
                        departamentoSelect.appendChild(option);
                    }
                });
            }
            
            if (mode === 'edit' && id) {
                fillFormWithData('feedbacks', id);
            }
        }

        function loadTipoMultaForm(mode = 'add', id = null) {
            let formHTML = `
                <div class="form-group" style="flex: 100%;">
                    <label for="nome">Nome do Tipo de Multa *</label>
                    <input type="text" id="nome" class="form-control" placeholder="Ex: Excesso de velocidade, Estacionamento irregular..." required>
                </div>
            `;
            
            document.getElementById('modal-form').innerHTML = formHTML;
            
            if (mode === 'edit' && id) {
                fillFormWithData('tiposMulta', id);
            }
        }

        function loadMultaForm(mode = 'add', id = null) {
            const hoje = new Date();
            const ano = hoje.getFullYear();
            const mes = String(hoje.getMonth() + 1).padStart(2, '0');
            const dia = String(hoje.getDate()).padStart(2, '0');
            const dataAtual = `${ano}-${mes}-${dia}`;
            
            let statusOptions = [
                'Colaborador ciente',
                'Aguardando CNH',
                'IndicaÃ§Ã£o realizada',
                'IndicaÃ§Ã£o aceita',
                'Aguardando penalidade',
                'Desconto Realizado',
                'Processo finalizado',
                'Aguardando recurso'
            ];
            
            let tipoOptions = '';
            tiposMultaData.sort((a, b) => (a.nome || '').localeCompare(b.nome || '')).forEach(tipo => {
                tipoOptions += `<option value="${tipo.nome}">${tipo.nome}</option>`;
            });
            
            let formHTML = `
                <div class="form-row">
                    <div class="form-group">
                        <label for="colaborador">Colaborador *</label>
                        <select id="colaborador" class="form-control" required>
                            <option value="">Selecione um colaborador</option>
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="data">Data da AutuaÃ§Ã£o *</label>
                        <input type="date" id="data" class="form-control" value="${dataAtual}" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="hora">Hora da AutuaÃ§Ã£o *</label>
                        <input type="time" id="hora" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="placa">Placa do Carro *</label>
                        <input type="text" id="placa" class="form-control" placeholder="ABC-1234" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="tipo">Tipo de Multa *</label>
                        <select id="tipo" class="form-control" required>
                            <option value="">Selecione o tipo</option>
                            ${tipoOptions}
                        </select>
                    </div>
                    <div class="form-group">
                        <label for="valor">Valor (R$) *</label>
                        <input type="number" id="valor" class="form-control" placeholder="0.00" step="0.01" min="0" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="ait">NÃºmero do AIT *</label>
                        <input type="text" id="ait" class="form-control" placeholder="Ex: 123456789" required>
                    </div>
                    <div class="form-group">
                        <label for="orgaoAutuador">Ã“rgÃ£o Autuador *</label>
                        <input type="text" id="orgaoAutuador" class="form-control" placeholder="Ex: DER, PolÃ­cia RodoviÃ¡ria..." required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="local">Local da InfraÃ§Ã£o *</label>
                        <input type="text" id="local" class="form-control" placeholder="Ex: Rodovia, Av. ..." required>
                    </div>
                    <div class="form-group">
                        <label for="municipio">MunicÃ­pio *</label>
                        <input type="text" id="municipio" class="form-control" placeholder="Ex: SÃ£o Paulo" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="dataLimiteIndicacao">Data Limite para IndicaÃ§Ã£o *</label>
                        <input type="date" id="dataLimiteIndicacao" class="form-control" required>
                    </div>
                    <div class="form-group">
                        <label for="status">Status *</label>
                        <select id="status" class="form-control" required>
                            <option value="">Selecione o status</option>
                            ${statusOptions.map(status => `<option value="${status}">${status}</option>`).join('')}
                        </select>
                    </div>
                </div>
            `;
            
            document.getElementById('modal-form').innerHTML = formHTML;
            
            const colaboradorSelect = document.getElementById('colaborador');
            if (colaboradorSelect) {
                colaboradorSelect.innerHTML = '<option value="">Selecione um colaborador</option>';
                colaboradoresData.forEach(colab => {
                    if (colab.nome && colab.status === 'Ativo') {
                        const option = document.createElement('option');
                        option.value = colab.nome;
                        option.textContent = colab.nome;
                        colaboradorSelect.appendChild(option);
                    }
                });
            }
            
            const dataLimite = new Date();
            dataLimite.setDate(dataLimite.getDate() + 30);
            const dataLimiteInput = document.getElementById('dataLimiteIndicacao');
            if (dataLimiteInput) {
                dataLimiteInput.value = dataLimite.toISOString().split('T')[0];
            }
            
            const horaInput = document.getElementById('hora');
            if (horaInput) {
                const now = new Date();
                const horas = String(now.getHours()).padStart(2, '0');
                const minutos = String(now.getMinutes()).padStart(2, '0');
                horaInput.value = `${horas}:${minutos}`;
            }
            
            if (mode === 'edit' && id) {
                fillFormWithData('multas', id);
            }
        }

        function loadTurnoverForm(mode = 'add', id = null) {
            const hoje = new Date();
            const ano = hoje.getFullYear();
            const mes = String(hoje.getMonth() + 1).padStart(2, '0');
            const mesAnoAtual = `${ano}-${mes}`;
            
            let formHTML = `
                <div class="form-row">
                    <div class="form-group" style="flex: 100%;">
                        <label for="mesAno">MÃªs/Ano *</label>
                        <input type="month" id="mesAno" class="form-control" value="${mesAnoAtual}" required>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="colaboradoresInicio">Colaboradores no InÃ­cio do MÃªs *</label>
                        <input type="number" id="colaboradoresInicio" class="form-control" placeholder="0" min="0" required>
                        <small style="color: var(--gray-color);">Total de colaboradores no primeiro dia do mÃªs</small>
                    </div>
                    <div class="form-group">
                        <label for="admissoes">AdmissÃµes no MÃªs</label>
                        <input type="number" id="admissoes" class="form-control" placeholder="0" min="0" value="0">
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group">
                        <label for="desligamentos">Desligamentos no MÃªs</label>
                        <input type="number" id="desligamentos" class="form-control" placeholder="0" min="0" value="0">
                    </div>
                    <div class="form-group">
                        <label for="colaboradoresFim">Colaboradores no Final do MÃªs *</label>
                        <input type="number" id="colaboradoresFim" class="form-control" placeholder="0" min="0" required>
                        <small style="color: var(--gray-color);">Total de colaboradores no Ãºltimo dia do mÃªs</small>
                    </div>
                </div>
                <div class="form-row">
                    <div class="form-group" style="flex: 100%;">
                        <label for="taxaTurnover">Taxa de Turnover (Calculada Automaticamente)</label>
                        <input type="text" id="taxaTurnover" class="form-control" readonly placeholder="0.00%">
                    </div>
                </div>
            `;
            
            document.getElementById('modal-form').innerHTML = formHTML;
            
            const colaboradoresInicio = document.getElementById('colaboradoresInicio');
            const admissoes = document.getElementById('admissoes');
            const desligamentos = document.getElementById('desligamentos');
            const colaboradoresFim = document.getElementById('colaboradoresFim');
            const taxaTurnover = document.getElementById('taxaTurnover');
            
            function calcularTaxa() {
                const inicio = parseInt(colaboradoresInicio.value) || 0;
                const fim = parseInt(colaboradoresFim.value) || 0;
                
                if (inicio > 0 && fim > 0) {
                    const media = (inicio + fim) / 2;
                    const deslig = parseInt(desligamentos.value) || 0;
                    const taxa = (deslig / media) * 100;
                    taxaTurnover.value = `${taxa.toFixed(2)}%`;
                } else {
                    taxaTurnover.value = '0.00%';
                }
            }
            
            colaboradoresInicio.addEventListener('input', calcularTaxa);
            admissoes.addEventListener('input', calcularTaxa);
            desligamentos.addEventListener('input', calcularTaxa);
            colaboradoresFim.addEventListener('input', calcularTaxa);
            
            if (mode === 'edit' && id) {
                fillFormWithData('turnover', id);
                
                setTimeout(() => {
                    calcularTaxa();
                }, 200);
            }
        }

        function populateSelectOptions() {
            const departamentoSelect = document.getElementById('departamento');
            const empresaSelect = document.getElementById('empresa');
            
            if (departamentoSelect) {
                departamentoSelect.innerHTML = '<option value="">Selecione um departamento</option>';
                departamentosData.sort((a, b) => (a.nome || '').localeCompare(b.nome || '')).forEach(depto => {
                    if (depto.nome) {
                        const option = document.createElement('option');
                        option.value = depto.nome;
                        option.textContent = depto.nome;
                        departamentoSelect.appendChild(option);
                    }
                });
            }
            
            if (empresaSelect) {
                empresaSelect.innerHTML = '<option value="">Selecione uma empresa</option>';
                empresasData.sort((a, b) => (a.nome || '').localeCompare(b.nome || '')).forEach(empresa => {
                    if (empresa.nome) {
                        const option = document.createElement('option');
                        option.value = empresa.nome;
                        option.textContent = empresa.nome;
                        empresaSelect.appendChild(option);
                    }
                });
            }
        }

        async function fillFormWithData(section, id) {
            try {
                const collectionName = collections[section];
                const collectionRef = firebaseApp.firestore.collection(firebaseApp.db, collectionName);
                const snapshot = await firebaseApp.firestore.getDocs(collectionRef);
                
                const doc = snapshot.docs.find(d => d.id === id);
                if (doc) {
                    const data = doc.data();
                    
                    Object.keys(data).forEach(key => {
                        const field = document.getElementById(key);
                        if (field) {
                            if (field.type === 'month' && data[key]) {
                                const dateStr = data[key];
                                if (dateStr.includes('T')) {
                                    const date = new Date(dateStr);
                                    const year = date.getFullYear();
                                    const month = String(date.getMonth() + 1).padStart(2, '0');
                                    field.value = `${year}-${month}`;
                                } else {
                                    field.value = dateStr;
                                }
                            } else if (field.type === 'date' && data[key]) {
                                const dateStr = data[key];
                                if (dateStr.includes('T')) {
                                    const date = new Date(dateStr);
                                    const year = date.getFullYear();
                                    const month = String(date.getMonth() + 1).padStart(2, '0');
                                    const day = String(date.getDate()).padStart(2, '0');
                                    field.value = `${year}-${month}-${day}`;
                                } else {
                                    field.value = dateStr.substring(0, 10);
                                }
                            } else if (field.type === 'time' && data[key]) {
                                field.value = data[key];
                            } else {
                                field.value = data[key];
                            }
                        }
                    });
                }
            } catch (error) {
                console.error(`Erro ao preencher formulÃ¡rio: ${error.message}`);
            }
        }

        // FunÃ§Ãµes de salvamento
        async function saveEmpresa(formData, mode, id) {
            try {
                const collectionName = 'empresas';
                const empresaData = {
                    nome: formData.nome,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                if (mode === 'add') {
                    const collectionRef = firebaseApp.firestore.collection(firebaseApp.db, collectionName);
                    const docRef = await firebaseApp.firestore.addDoc(collectionRef, empresaData);
                    console.log(`âœ… Empresa adicionada com ID: ${docRef.id}`);
                    return true;
                } else if (mode === 'edit' && id) {
                    const docRef = firebaseApp.firestore.doc(firebaseApp.db, collectionName, id);
                    await firebaseApp.firestore.updateDoc(docRef, empresaData);
                    console.log(`âœ… Empresa atualizada: ${id}`);
                    return true;
                }
            } catch (error) {
                console.error(`âŒ Erro ao salvar empresa: ${error.message}`);
                return false;
            }
        }

        async function saveDepartamento(formData, mode, id) {
            try {
                const collectionName = 'departamentos';
                const departamentoData = {
                    nome: formData.nome,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                if (mode === 'add') {
                    const collectionRef = firebaseApp.firestore.collection(firebaseApp.db, collectionName);
                    const docRef = await firebaseApp.firestore.addDoc(collectionRef, departamentoData);
                    console.log(`âœ… Departamento adicionado com ID: ${docRef.id}`);
                    return true;
                } else if (mode === 'edit' && id) {
                    const docRef = firebaseApp.firestore.doc(firebaseApp.db, collectionName, id);
                    await firebaseApp.firestore.updateDoc(docRef, departamentoData);
                    console.log(`âœ… Departamento atualizado: ${id}`);
                    return true;
                }
            } catch (error) {
                console.error(`âŒ Erro ao salvar departamento: ${error.message}`);
                return false;
            }
        }

        async function saveColaborador(formData, mode, id) {
            try {
                const collectionName = 'colaboradores';
                const colaboradorData = {
                    nome: formData.nome,
                    dataAdmissao: formData.dataAdmissao,
                    departamento: formData.departamento,
                    empresa: formData.empresa,
                    status: formData.status || 'Ativo',
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                if (mode === 'add') {
                    const collectionRef = firebaseApp.firestore.collection(firebaseApp.db, collectionName);
                    const docRef = await firebaseApp.firestore.addDoc(collectionRef, colaboradorData);
                    console.log(`âœ… Colaborador adicionado com ID: ${docRef.id}`);
                    return true;
                } else if (mode === 'edit' && id) {
                    const docRef = firebaseApp.firestore.doc(firebaseApp.db, collectionName, id);
                    await firebaseApp.firestore.updateDoc(docRef, colaboradorData);
                    console.log(`âœ… Colaborador atualizado: ${id}`);
                    return true;
                }
            } catch (error) {
                console.error(`âŒ Erro ao salvar colaborador: ${error.message}`);
                return false;
            }
        }

        async function saveAdvertencia(formData, mode, id) {
            try {
                const collectionName = 'advertencias';
                
                const advertenciaData = {
                    colaborador: formData.colaborador,
                    data: formData.data,
                    motivo: formData.motivo,
                    status: 'Ativa',
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                if (mode === 'add') {
                    const collectionRef = firebaseApp.firestore.collection(firebaseApp.db, collectionName);
                    const docRef = await firebaseApp.firestore.addDoc(collectionRef, advertenciaData);
                    console.log(`âœ… AdvertÃªncia adicionada com ID: ${docRef.id}`);
                    return true;
                } else if (mode === 'edit' && id) {
                    const docRef = firebaseApp.firestore.doc(firebaseApp.db, collectionName, id);
                    await firebaseApp.firestore.updateDoc(docRef, advertenciaData);
                    console.log(`âœ… AdvertÃªncia atualizada: ${id}`);
                    return true;
                }
            } catch (error) {
                console.error(`âŒ Erro ao salvar advertÃªncia: ${error.message}`);
                return false;
            }
        }

        async function saveDano(formData, mode, id) {
            try {
                const collectionName = 'danos';
                
                let motivoFinal = formData.motivo;
                if (formData.motivo === 'Outro' && formData.outroMotivo) {
                    motivoFinal = formData.outroMotivo;
                }
                
                const danoData = {
                    colaborador: formData.colaborador,
                    data: formData.data,
                    motivo: motivoFinal,
                    valor: parseFloat(formData.valor) || 0,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                if (mode === 'add') {
                    const collectionRef = firebaseApp.firestore.collection(firebaseApp.db, collectionName);
                    const docRef = await firebaseApp.firestore.addDoc(collectionRef, danoData);
                    console.log(`âœ… Dano registrado com ID: ${docRef.id}`);
                    return true;
                } else if (mode === 'edit' && id) {
                    const docRef = firebaseApp.firestore.doc(firebaseApp.db, collectionName, id);
                    await firebaseApp.firestore.updateDoc(docRef, danoData);
                    console.log(`âœ… Dano atualizado: ${id}`);
                    return true;
                }
            } catch (error) {
                console.error(`âŒ Erro ao salvar dano: ${error.message}`);
                return false;
            }
        }

        async function saveFalta(formData, mode, id) {
            try {
                const collectionName = 'faltas';
                
                if (!formData.colaborador) {
                    throw new Error('Selecione um colaborador');
                }
                
                if (!formData.dataInicio) {
                    throw new Error('Selecione a data de inÃ­cio da falta');
                }
                
                const dataFim = formData.dataFim || formData.dataInicio;
                const quantidade = calcularDiasEntreDatas(formData.dataInicio, dataFim);
                
                const faltaData = {
                    colaborador: formData.colaborador,
                    dataInicio: formData.dataInicio,
                    dataFim: dataFim,
                    quantidade: quantidade,
                    justificativa: formData.justificativa || '',
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                if (mode === 'add') {
                    const collectionRef = firebaseApp.firestore.collection(firebaseApp.db, collectionName);
                    const docRef = await firebaseApp.firestore.addDoc(collectionRef, faltaData);
                    console.log(`âœ… Falta registrada com ID: ${docRef.id} - ${quantidade} dia(s)`);
                    return true;
                } else if (mode === 'edit' && id) {
                    const docRef = firebaseApp.firestore.doc(firebaseApp.db, collectionName, id);
                    await firebaseApp.firestore.updateDoc(docRef, faltaData);
                    console.log(`âœ… Falta atualizada: ${id} - ${quantidade} dia(s)`);
                    return true;
                }
            } catch (error) {
                console.error(`âŒ Erro ao salvar falta: ${error.message}`);
                throw error;
            }
        }

        async function saveFeedback(formData, mode, id) {
            try {
                const collectionName = 'feedbacks';
                const feedbackData = {
                    mesAno: formData.mesAno,
                    departamento: formData.departamento,
                    positivos: parseInt(formData.positivos) || 0,
                    neutros: parseInt(formData.neutros) || 0,
                    melhorar: parseInt(formData.melhorar) || 0,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                if (mode === 'add') {
                    const feedbacksRef = firebaseApp.firestore.collection(firebaseApp.db, collectionName);
                    const q = firebaseApp.firestore.query(
                        feedbacksRef,
                        firebaseApp.firestore.where("mesAno", "==", formData.mesAno),
                        firebaseApp.firestore.where("departamento", "==", formData.departamento)
                    );
                    
                    const existingSnapshot = await firebaseApp.firestore.getDocs(q);
                    
                    if (!existingSnapshot.empty) {
                        throw new Error(`JÃ¡ existe um registro de feedbacks para ${formData.departamento} em ${formData.mesAno}.`);
                    }
                }
                
                if (mode === 'add') {
                    const collectionRef = firebaseApp.firestore.collection(firebaseApp.db, collectionName);
                    const docRef = await firebaseApp.firestore.addDoc(collectionRef, feedbackData);
                    console.log(`âœ… Feedback adicionado com ID: ${docRef.id}`);
                    return true;
                } else if (mode === 'edit' && id) {
                    const docRef = firebaseApp.firestore.doc(firebaseApp.db, collectionName, id);
                    await firebaseApp.firestore.updateDoc(docRef, feedbackData);
                    console.log(`âœ… Feedback atualizado: ${id}`);
                    return true;
                }
            } catch (error) {
                console.error(`âŒ Erro ao salvar feedback: ${error.message}`);
                throw error;
            }
        }

        async function saveTipoMulta(formData, mode, id) {
            try {
                const collectionName = 'tiposMulta';
                const tipoData = {
                    nome: formData.nome,
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                if (mode === 'add') {
                    const collectionRef = firebaseApp.firestore.collection(firebaseApp.db, collectionName);
                    const docRef = await firebaseApp.firestore.addDoc(collectionRef, tipoData);
                    console.log(`âœ… Tipo de multa adicionado com ID: ${docRef.id}`);
                    return true;
                } else if (mode === 'edit' && id) {
                    const docRef = firebaseApp.firestore.doc(firebaseApp.db, collectionName, id);
                    await firebaseApp.firestore.updateDoc(docRef, tipoData);
                    console.log(`âœ… Tipo de multa atualizado: ${id}`);
                    return true;
                }
            } catch (error) {
                console.error(`âŒ Erro ao salvar tipo de multa: ${error.message}`);
                return false;
            }
        }

        async function saveMulta(formData, mode, id) {
            try {
                const collectionName = 'multas';
                
                const multaData = {
                    colaborador: formData.colaborador,
                    data: formData.data,
                    hora: formData.hora,
                    placa: formData.placa.toUpperCase(),
                    tipo: formData.tipo,
                    valor: parseFloat(formData.valor) || 0,
                    ait: formData.ait,
                    orgaoAutuador: formData.orgaoAutuador,
                    local: formData.local,
                    municipio: formData.municipio,
                    dataLimiteIndicacao: formData.dataLimiteIndicacao,
                    status: formData.status || 'Colaborador ciente',
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                if (mode === 'add') {
                    const collectionRef = firebaseApp.firestore.collection(firebaseApp.db, collectionName);
                    const docRef = await firebaseApp.firestore.addDoc(collectionRef, multaData);
                    console.log(`âœ… Multa adicionada com ID: ${docRef.id}`);
                    return true;
                } else if (mode === 'edit' && id) {
                    const docRef = firebaseApp.firestore.doc(firebaseApp.db, collectionName, id);
                    await firebaseApp.firestore.updateDoc(docRef, multaData);
                    console.log(`âœ… Multa atualizada: ${id}`);
                    return true;
                }
            } catch (error) {
                console.error(`âŒ Erro ao salvar multa: ${error.message}`);
                return false;
            }
        }

        async function saveTurnover(formData, mode, id) {
            try {
                const collectionName = 'turnover';
                
                const validacao = validarRegistroTurnover(formData);
                if (!validacao.valido) {
                    showAlert(validacao.mensagem, 'warning', 'turnover-alert');
                    return false;
                }
                
                const inicio = parseInt(formData.colaboradoresInicio) || 0;
                const fim = parseInt(formData.colaboradoresFim) || 0;
                const desligamento = parseInt(formData.desligamentos) || 0;
                const media = (inicio + fim) / 2;
                const taxa = media > 0 ? (desligamento / media) * 100 : 0;
                
                const turnoverData = {
                    mesAno: formData.mesAno,
                    colaboradoresInicio: inicio,
                    admissoes: parseInt(formData.admissoes) || 0,
                    desligamentos: desligamento,
                    colaboradoresFim: fim,
                    taxaTurnover: taxa.toFixed(2),
                    createdAt: new Date().toISOString(),
                    updatedAt: new Date().toISOString()
                };
                
                if (mode === 'add') {
                    const collectionRef = firebaseApp.firestore.collection(firebaseApp.db, collectionName);
                    const docRef = await firebaseApp.firestore.addDoc(collectionRef, turnoverData);
                    console.log(`âœ… Turnover registrado com ID: ${docRef.id} - Taxa: ${taxa.toFixed(2)}%`);
                    return true;
                } else if (mode === 'edit' && id) {
                    const docRef = firebaseApp.firestore.doc(firebaseApp.db, collectionName, id);
                    await firebaseApp.firestore.updateDoc(docRef, turnoverData);
                    console.log(`âœ… Turnover atualizado: ${id} - Taxa: ${taxa.toFixed(2)}%`);
                    return true;
                }
            } catch (error) {
                console.error(`âŒ Erro ao salvar turnover: ${error.message}`);
                return false;
            }
        }

        function openModal(section, mode = 'add', id = null) {
            currentSection = section;
            currentAction = mode;
            currentItemId = id;
            currentCollection = collections[section];
            
            const titles = {
                empresas: 'Empresa',
                departamentos: 'Departamento',
                colaboradores: 'Colaborador',
                advertencias: 'AdvertÃªncia',
                danos: 'Dano/Avaria',
                faltas: 'Falta',
                feedbacks: 'Feedbacks',
                tiposMulta: 'Tipo de Multa',
                multas: 'Multa',
                turnover: 'Turnover'
            };
            
            document.getElementById('modal-title').textContent = 
                `${mode === 'add' ? 'Registrar' : 'Editar'} ${titles[section] || 'Item'}`;
            
            if (section === 'empresas') {
                loadEmpresaForm(mode, id);
            } else if (section === 'departamentos') {
                loadDepartamentoForm(mode, id);
            } else if (section === 'colaboradores') {
                loadColaboradorForm(mode, id);
            } else if (section === 'advertencias') {
                loadAdvertenciaForm(mode, id);
            } else if (section === 'danos') {
                loadDanoForm(mode, id);
            } else if (section === 'faltas') {
                loadFaltaForm(mode, id);
            } else if (section === 'feedbacks') {
                loadFeedbackForm(mode, id);
            } else if (section === 'tiposMulta') {
                loadTipoMultaForm(mode, id);
            } else if (section === 'multas') {
                loadMultaForm(mode, id);
            } else if (section === 'turnover') {
                loadTurnoverForm(mode, id);
            }
            
            document.getElementById('modal').style.display = 'flex';
        }

        function closeModal() {
            document.getElementById('modal').style.display = 'none';
            document.getElementById('modal-form').innerHTML = '';
            currentItemId = null;
        }

        async function handleFormSubmit() {
            const form = document.getElementById('modal-form');
            const formData = {};
            
            const inputs = form.querySelectorAll('input, select, textarea');
            inputs.forEach(input => {
                if (input.id) {
                    formData[input.id] = input.value;
                }
            });
            
            const requiredFields = form.querySelectorAll('[required]');
            let isValid = true;
            
            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    isValid = false;
                    field.style.borderColor = 'var(--accent-color)';
                } else {
                    field.style.borderColor = '#ddd';
                }
            });
            
            if (!isValid) {
                alert('Por favor, preencha todos os campos obrigatÃ³rios (*).');
                return;
            }
            
            if (currentSection === 'colaboradores') {
                if (!formData.departamento) {
                    alert('Por favor, selecione um departamento.');
                    return;
                }
                if (!formData.empresa) {
                    alert('Por favor, selecione uma empresa.');
                    return;
                }
            }
            
            if (currentSection === 'danos') {
                if (!formData.motivo) {
                    alert('Por favor, selecione um motivo.');
                    return;
                }
                if (formData.motivo === 'Outro' && (!formData.outroMotivo || !formData.outroMotivo.trim())) {
                    alert('Por favor, especifique o motivo.');
                    return;
                }
                if (!formData.valor || parseFloat(formData.valor) <= 0) {
                    alert('Por favor, informe um valor vÃ¡lido.');
                    return;
                }
            }
            
            if (currentSection === 'faltas') {
                if (!formData.colaborador) {
                    alert('Por favor, selecione um colaborador.');
                    return;
                }
                if (!formData.dataInicio) {
                    alert('Por favor, selecione a data de inÃ­cio da falta.');
                    return;
                }
                if (!formData.dataFim) {
                    formData.dataFim = formData.dataInicio;
                }
                
                const dataInicio = new Date(formData.dataInicio);
                const dataFim = new Date(formData.dataFim);
                
                if (dataFim < dataInicio) {
                    alert('A data fim nÃ£o pode ser anterior Ã  data inÃ­cio.');
                    return;
                }
            }
            
            if (currentSection === 'feedbacks') {
                if (!formData.departamento) {
                    alert('Por favor, selecione um departamento.');
                    return;
                }
            }
            
            if (currentSection === 'multas') {
                if (!formData.colaborador) {
                    alert('Por favor, selecione um colaborador.');
                    return;
                }
                if (!formData.tipo) {
                    alert('Por favor, selecione o tipo de multa.');
                    return;
                }
                if (!formData.valor || parseFloat(formData.valor) <= 0) {
                    alert('Por favor, informe um valor vÃ¡lido para a multa.');
                    return;
                }
                if (!formData.placa) {
                    alert('Por favor, informe a placa do veÃ­culo.');
                    return;
                }
                if (!formData.ait) {
                    alert('Por favor, informe o nÃºmero do AIT.');
                    return;
                }
                if (!formData.orgaoAutuador) {
                    alert('Por favor, informe o Ã³rgÃ£o autuador.');
                    return;
                }
                if (!formData.local) {
                    alert('Por favor, informe o local da infraÃ§Ã£o.');
                    return;
                }
                if (!formData.municipio) {
                    alert('Por favor, informe o municÃ­pio.');
                    return;
                }
                if (!formData.dataLimiteIndicacao) {
                    alert('Por favor, informe a data limite para indicaÃ§Ã£o.');
                    return;
                }
            }
            
            if (currentSection === 'turnover') {
                if (!formData.mesAno) {
                    alert('Por favor, selecione o mÃªs/ano.');
                    return;
                }
            }
            
            try {
                let success = false;
                
                if (currentSection === 'empresas') {
                    success = await saveEmpresa(formData, currentAction, currentItemId);
                } else if (currentSection === 'departamentos') {
                    success = await saveDepartamento(formData, currentAction, currentItemId);
                } else if (currentSection === 'colaboradores') {
                    success = await saveColaborador(formData, currentAction, currentItemId);
                } else if (currentSection === 'advertencias') {
                    success = await saveAdvertencia(formData, currentAction, currentItemId);
                } else if (currentSection === 'danos') {
                    success = await saveDano(formData, currentAction, currentItemId);
                } else if (currentSection === 'faltas') {
                    success = await saveFalta(formData, currentAction, currentItemId);
                } else if (currentSection === 'feedbacks') {
                    success = await saveFeedback(formData, currentAction, currentItemId);
                } else if (currentSection === 'tiposMulta') {
                    success = await saveTipoMulta(formData, currentAction, currentItemId);
                } else if (currentSection === 'multas') {
                    success = await saveMulta(formData, currentAction, currentItemId);
                } else if (currentSection === 'turnover') {
                    success = await saveTurnover(formData, currentAction, currentItemId);
                }
                
                if (success) {
                    showAlert(`${currentSection.charAt(0).toUpperCase() + currentSection.slice(1)} salvo com sucesso!`, 'success', `${currentSection}-alert`);
                    closeModal();
                    await updateDashboardCounts();
                    if (currentSection === 'multas') {
                        await updateMultasStats();
                    }
                    if (currentSection === 'danos') {
                        const snapshot = await firebaseApp.firestore.getDocs(firebaseApp.firestore.collection(firebaseApp.db, 'danos'));
                        const docs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        const filteredDocs = applyDanosFilters(docs);
                        updateDanosStats(filteredDocs);
                    }
                    if (currentSection === 'faltas') {
                        const snapshot = await firebaseApp.firestore.getDocs(firebaseApp.firestore.collection(firebaseApp.db, 'faltas'));
                        const docs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        const filteredDocs = applyFaltasFilters(docs);
                        updateFaltasStats(filteredDocs);
                    }
                    if (currentSection === 'feedbacks') {
                        const snapshot = await firebaseApp.firestore.getDocs(firebaseApp.firestore.collection(firebaseApp.db, 'feedbacks'));
                        const docs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        const filteredDocs = applyFeedbacksFilters(docs);
                        updateFeedbackStats(filteredDocs, false);
                    }
                    if (currentSection === 'turnover') {
                        await loadTableData('turnover');
                        updateTurnoverTaxaAtual();
                    }
                } else {
                    showAlert('Erro ao salvar. Verifique o console (F12).', 'error', `${currentSection}-alert`);
                }
            } catch (error) {
                console.error(`âŒ Erro no submit: ${error.message}`);
                showAlert(`Erro: ${error.message}`, 'error', `${currentSection}-alert`);
            }
        }

        function aplicarFiltrosColaboradoresAutomatico() {
            colaboradoresFiltroAtual.status = document.getElementById('filtro-status-colaborador').value;
            colaboradoresFiltroAtual.nome = document.getElementById('filtro-nome-colaborador').value;
            colaboradoresFiltroAtual.departamento = document.getElementById('filtro-departamento-colaborador').value;
            colaboradoresFiltroAtual.empresa = document.getElementById('filtro-empresa-colaborador').value;
            
            loadTableData('colaboradores');
        }

        function aplicarFiltrosAdvertenciasAutomatico() {
            advertenciasFiltroAtual.nome = document.getElementById('filtro-nome').value;
            advertenciasFiltroAtual.departamento = document.getElementById('filtro-departamento').value;
            advertenciasFiltroAtual.dataInicio = document.getElementById('filtro-data-inicio').value;
            advertenciasFiltroAtual.dataFim = document.getElementById('filtro-data-fim').value;
            
            loadTableData('advertencias');
        }

        function aplicarFiltrosFaltasAutomatico() {
            faltasFiltroAtual.nome = document.getElementById('filtro-nome-falta').value;
            faltasFiltroAtual.departamento = document.getElementById('filtro-departamento-falta').value;
            faltasFiltroAtual.dataInicio = document.getElementById('filtro-data-inicio-falta').value;
            faltasFiltroAtual.dataFim = document.getElementById('filtro-data-fim-falta').value;
            
            loadTableData('faltas');
        }

        function aplicarFiltrosDanosAutomatico() {
            danosFiltroAtual.nome = document.getElementById('filtro-nome-dano').value;
            danosFiltroAtual.departamento = document.getElementById('filtro-departamento-dano').value;
            danosFiltroAtual.dataInicio = document.getElementById('filtro-data-inicio-dano').value;
            danosFiltroAtual.dataFim = document.getElementById('filtro-data-fim-dano').value;
            
            loadTableData('danos');
        }

        function aplicarFiltrosFeedbacksAutomatico() {
            feedbacksFiltroAtual.mesAno = document.getElementById('filtro-mes-feedback').value;
            feedbacksFiltroAtual.departamento = document.getElementById('filtro-departamento-feedback').value;
            
            loadTableData('feedbacks');
            
            setTimeout(async () => {
                const feedbacksRef = firebaseApp.firestore.collection(firebaseApp.db, 'feedbacks');
                const snapshot = await firebaseApp.firestore.getDocs(feedbacksRef);
                const docs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                updateFeedbackStats(docs, false);
            }, 100);
        }

        function aplicarFiltrosMultasAutomatico() {
            multasFiltroAtual.nome = document.getElementById('filtro-nome-multa').value;
            multasFiltroAtual.departamento = document.getElementById('filtro-departamento-multa').value;
            multasFiltroAtual.status = document.getElementById('filtro-status-multa').value;
            multasFiltroAtual.placa = document.getElementById('filtro-placa-multa').value;
            multasFiltroAtual.ait = document.getElementById('filtro-ait-multa').value;
            multasFiltroAtual.dataInicio = document.getElementById('filtro-data-inicio-multa').value;
            multasFiltroAtual.dataFim = document.getElementById('filtro-data-fim-multa').value;
            
            loadTableData('multas');
        }

        function setupEventListeners() {
            document.querySelectorAll('.sidebar-menu a').forEach(link => {
                link.addEventListener('click', function(e) {
                    e.preventDefault();
                    document.querySelectorAll('.sidebar-menu a').forEach(l => l.classList.remove('active'));
                    this.classList.add('active');
                    
                    const targetSection = this.getAttribute('data-section');
                    currentSection = targetSection;
                    
                    document.querySelectorAll('.section-content').forEach(s => s.style.display = 'none');
                    document.getElementById(targetSection).style.display = 'block';
                    
                    const titles = {
                        dashboard: 'Dashboard',
                        turnover: 'Turnover',
                        empresas: 'Empresas',
                        departamentos: 'Departamentos',
                        colaboradores: 'Colaboradores',
                        advertencias: 'AdvertÃªncias',
                        danos: 'Danos e Avarias',
                        faltas: 'Faltas',
                        feedbacks: 'Feedbacks',
                        'tipos-multa': 'Tipos de Multa',
                        multas: 'Multas'
                    };
                    document.getElementById('page-title').textContent = titles[targetSection] || 'Dashboard';
                    
                    document.querySelectorAll('.filters-container').forEach(container => {
                        container.classList.remove('show');
                    });
                    
                    document.querySelectorAll('.btn-toggle-filters').forEach(btn => {
                        btn.innerHTML = '<i class="fas fa-filter"></i> Mostrar Filtros';
                        btn.classList.remove('active');
                    });
                    
                    if (targetSection === 'colaboradores') {
                        updateColaboradoresFilterOptions();
                    }
                    
                    if (targetSection === 'advertencias') {
                        const departamentoSelect = document.getElementById('filtro-departamento');
                        if (departamentoSelect) {
                            departamentoSelect.innerHTML = '<option value="">Todos os departamentos</option>';
                            const departamentosUnicos = [...new Set(departamentosData.map(d => d.nome).filter(Boolean))];
                            departamentosUnicos.sort().forEach(depto => {
                                const option = document.createElement('option');
                                option.value = depto;
                                option.textContent = depto;
                                departamentoSelect.appendChild(option);
                            });
                        }
                        loadTableData('advertencias');
                    }
                    
                    if (targetSection === 'faltas') {
                        const departamentoSelect = document.getElementById('filtro-departamento-falta');
                        if (departamentoSelect) {
                            departamentoSelect.innerHTML = '<option value="">Todos os departamentos</option>';
                            const departamentosUnicos = [...new Set(departamentosData.map(d => d.nome).filter(Boolean))];
                            departamentosUnicos.sort().forEach(depto => {
                                const option = document.createElement('option');
                                option.value = depto;
                                option.textContent = depto;
                                departamentoSelect.appendChild(option);
                            });
                        }
                        loadTableData('faltas');
                    }
                    
                    if (targetSection === 'danos') {
                        const departamentoSelect = document.getElementById('filtro-departamento-dano');
                        if (departamentoSelect) {
                            departamentoSelect.innerHTML = '<option value="">Todos os departamentos</option>';
                            const departamentosUnicos = [...new Set(departamentosData.map(d => d.nome).filter(Boolean))];
                            departamentosUnicos.sort().forEach(depto => {
                                const option = document.createElement('option');
                                option.value = depto;
                                option.textContent = depto;
                                departamentoSelect.appendChild(option);
                            });
                        }
                        loadTableData('danos');
                    }
                    
                    if (targetSection === 'feedbacks') {
                        const departamentoSelect = document.getElementById('filtro-departamento-feedback');
                        if (departamentoSelect) {
                            departamentoSelect.innerHTML = '<option value="">Todos os departamentos</option>';
                            const departamentosUnicos = [...new Set(departamentosData.map(d => d.nome).filter(Boolean))];
                            departamentosUnicos.sort().forEach(depto => {
                                const option = document.createElement('option');
                                option.value = depto;
                                option.textContent = depto;
                                departamentoSelect.appendChild(option);
                            });
                        }
                        
                        loadTableData('feedbacks');
                        
                        setTimeout(async () => {
                            const feedbacksRef = firebaseApp.firestore.collection(firebaseApp.db, 'feedbacks');
                            const snapshot = await firebaseApp.firestore.getDocs(feedbacksRef);
                            const docs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                            updateFeedbackStats(docs, true);
                        }, 100);
                    }
                    
                    if (targetSection === 'multas') {
                        const departamentoSelect = document.getElementById('filtro-departamento-multa');
                        if (departamentoSelect) {
                            departamentoSelect.innerHTML = '<option value="">Todos os departamentos</option>';
                            const departamentosUnicos = [...new Set(departamentosData.map(d => d.nome).filter(Boolean))];
                            departamentosUnicos.sort().forEach(depto => {
                                const option = document.createElement('option');
                                option.value = depto;
                                option.textContent = depto;
                                departamentoSelect.appendChild(option);
                            });
                        }
                        loadTableData('multas');
                        updateMultasStats();
                    }
                    
                    if (targetSection === 'tipos-multa') {
                        loadTableData('tiposMulta');
                    }
                    
                    if (targetSection === 'turnover') {
                        loadTableData('turnover');
                        updateTurnoverTaxaAtual();
                    }
                });
            });

            document.getElementById('add-empresa-btn').addEventListener('click', () => openModal('empresas', 'add'));
            document.getElementById('add-departamento-btn').addEventListener('click', () => openModal('departamentos', 'add'));
            document.getElementById('add-colaborador-btn').addEventListener('click', () => openModal('colaboradores', 'add'));
            document.getElementById('add-advertencia-btn').addEventListener('click', () => openModal('advertencias', 'add'));
            document.getElementById('add-dano-btn').addEventListener('click', () => openModal('danos', 'add'));
            document.getElementById('add-falta-btn').addEventListener('click', () => openModal('faltas', 'add'));
            document.getElementById('add-feedback-btn').addEventListener('click', () => openModal('feedbacks', 'add'));
            document.getElementById('add-tipo-multa-btn').addEventListener('click', () => openModal('tiposMulta', 'add'));
            document.getElementById('add-multa-btn').addEventListener('click', () => openModal('multas', 'add'));
            document.getElementById('add-turnover-btn').addEventListener('click', () => openModal('turnover', 'add'));

            document.getElementById('toggle-filters-colaboradores').addEventListener('click', () => toggleFilters('colaboradores'));
            document.getElementById('toggle-filters-advertencias').addEventListener('click', () => toggleFilters('advertencias'));
            document.getElementById('toggle-filters-faltas').addEventListener('click', () => toggleFilters('faltas'));
            document.getElementById('toggle-filters-danos').addEventListener('click', () => toggleFilters('danos'));
            document.getElementById('toggle-filters-feedbacks').addEventListener('click', () => toggleFilters('feedbacks'));
            document.getElementById('toggle-filters-multas').addEventListener('click', () => toggleFilters('multas'));

            document.getElementById('close-modal').addEventListener('click', closeModal);
            document.getElementById('cancel-form').addEventListener('click', closeModal);
            document.getElementById('submit-form').addEventListener('click', handleFormSubmit);
            
            document.getElementById('filtro-status-colaborador').addEventListener('change', aplicarFiltrosColaboradoresAutomatico);
            document.getElementById('filtro-nome-colaborador').addEventListener('input', aplicarFiltrosColaboradoresAutomatico);
            document.getElementById('filtro-departamento-colaborador').addEventListener('change', aplicarFiltrosColaboradoresAutomatico);
            document.getElementById('filtro-empresa-colaborador').addEventListener('change', aplicarFiltrosColaboradoresAutomatico);
            
            document.getElementById('filtro-nome').addEventListener('input', aplicarFiltrosAdvertenciasAutomatico);
            document.getElementById('filtro-departamento').addEventListener('change', aplicarFiltrosAdvertenciasAutomatico);
            document.getElementById('filtro-data-inicio').addEventListener('change', aplicarFiltrosAdvertenciasAutomatico);
            document.getElementById('filtro-data-fim').addEventListener('change', aplicarFiltrosAdvertenciasAutomatico);
            
            document.getElementById('filtro-nome-falta').addEventListener('input', aplicarFiltrosFaltasAutomatico);
            document.getElementById('filtro-departamento-falta').addEventListener('change', aplicarFiltrosFaltasAutomatico);
            document.getElementById('filtro-data-inicio-falta').addEventListener('change', aplicarFiltrosFaltasAutomatico);
            document.getElementById('filtro-data-fim-falta').addEventListener('change', aplicarFiltrosFaltasAutomatico);
            
            document.getElementById('filtro-nome-dano').addEventListener('input', aplicarFiltrosDanosAutomatico);
            document.getElementById('filtro-departamento-dano').addEventListener('change', aplicarFiltrosDanosAutomatico);
            document.getElementById('filtro-data-inicio-dano').addEventListener('change', aplicarFiltrosDanosAutomatico);
            document.getElementById('filtro-data-fim-dano').addEventListener('change', aplicarFiltrosDanosAutomatico);
            
            document.getElementById('filtro-mes-feedback').addEventListener('change', aplicarFiltrosFeedbacksAutomatico);
            document.getElementById('filtro-departamento-feedback').addEventListener('change', aplicarFiltrosFeedbacksAutomatico);
            
            document.getElementById('filtro-nome-multa').addEventListener('input', aplicarFiltrosMultasAutomatico);
            document.getElementById('filtro-departamento-multa').addEventListener('change', aplicarFiltrosMultasAutomatico);
            document.getElementById('filtro-status-multa').addEventListener('change', aplicarFiltrosMultasAutomatico);
            document.getElementById('filtro-placa-multa').addEventListener('input', aplicarFiltrosMultasAutomatico);
            document.getElementById('filtro-ait-multa').addEventListener('input', aplicarFiltrosMultasAutomatico);
            document.getElementById('filtro-data-inicio-multa').addEventListener('change', aplicarFiltrosMultasAutomatico);
            document.getElementById('filtro-data-fim-multa').addEventListener('change', aplicarFiltrosMultasAutomatico);
            
            document.getElementById('modal').addEventListener('click', function(e) {
                if (e.target === this) closeModal();
            });
        }

        window.editItem = function(section, id) {
            openModal(section, 'edit', id);
        };

        window.deleteItem = async function(section, id) {
            if (!confirm('Tem certeza que deseja excluir este item?')) return;
            
            try {
                const collectionName = collections[section];
                const docRef = firebaseApp.firestore.doc(firebaseApp.db, collectionName, id);
                await firebaseApp.firestore.deleteDoc(docRef);
                
                console.log(`âœ… ${section} excluÃ­do: ${id}`);
                showAlert('Item excluÃ­do com sucesso!', 'success', `${section}-alert`);
                
                if (['colaboradores', 'advertencias', 'faltas', 'multas', 'feedbacks', 'danos', 'tiposMulta', 'turnover'].includes(section)) {
                    await updateDashboardCounts();
                    if (section === 'multas') {
                        await updateMultasStats();
                    }
                    if (section === 'danos') {
                        const snapshot = await firebaseApp.firestore.getDocs(firebaseApp.firestore.collection(firebaseApp.db, 'danos'));
                        const docs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        const filteredDocs = applyDanosFilters(docs);
                        updateDanosStats(filteredDocs);
                    }
                    if (section === 'faltas') {
                        const snapshot = await firebaseApp.firestore.getDocs(firebaseApp.firestore.collection(firebaseApp.db, 'faltas'));
                        const docs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        const filteredDocs = applyFaltasFilters(docs);
                        updateFaltasStats(filteredDocs);
                    }
                    if (section === 'feedbacks') {
                        const snapshot = await firebaseApp.firestore.getDocs(firebaseApp.firestore.collection(firebaseApp.db, 'feedbacks'));
                        const docs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
                        const filteredDocs = applyFeedbacksFilters(docs);
                        updateFeedbackStats(filteredDocs, false);
                    }
                    if (section === 'turnover') {
                        await loadTableData('turnover');
                        updateTurnoverTaxaAtual();
                    }
                }
            } catch (error) {
                console.error(`âŒ Erro ao excluir: ${error.message}`);
                showAlert(`Erro ao excluir: ${error.message}`, 'error', `${section}-alert`);
            }
        };

        function parseDateExactly(dateString) {
            if (!dateString) return null;
            try {
                if (dateString.includes('-') && dateString.length === 10) {
                    const [year, month, day] = dateString.split('-');
                    return new Date(year, month - 1, day);
                }
                
                if (dateString.includes('T')) {
                    return new Date(dateString);
                }
                
                if (dateString.includes('-') && dateString.length === 7) {
                    const [year, month] = dateString.split('-');
                    return new Date(year, month - 1, 1);
                }
                
                return new Date(dateString);
            } catch {
                return null;
            }
        }

        function formatDateExactly(dateString) {
            if (!dateString) return 'N/A';
            try {
                if (dateString.includes('-') && dateString.length === 10) {
                    const [year, month, day] = dateString.split('-');
                    return `${day.padStart(2, '0')}/${month.padStart(2, '0')}/${year}`;
                }
                
                if (dateString.includes('T')) {
                    const date = new Date(dateString);
                    const day = String(date.getDate()).padStart(2, '0');
                    const month = String(date.getMonth() + 1).padStart(2, '0');
                    const year = date.getFullYear();
                    return `${day}/${month}/${year}`;
                }
                
                return dateString;
            } catch {
                return dateString;
            }
        }

        function showAlert(message, type = 'info', targetId = null) {
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.innerHTML = `
                <i class="fas fa-${type === 'success' ? 'check-circle' : type === 'error' ? 'exclamation-circle' : 'info-circle'}"></i>
                <span>${message}</span>
            `;
            
            if (targetId) {
                const target = document.getElementById(targetId);
                if (target) {
                    target.innerHTML = '';
                    target.appendChild(alertDiv);
                }
            } else {
                const mainContent = document.querySelector('.main-content');
                if (mainContent) {
                    mainContent.insertBefore(alertDiv, mainContent.firstChild);
                }
            }
            
            setTimeout(() => {
                if (alertDiv.parentNode) {
                    alertDiv.parentNode.removeChild(alertDiv);
                }
            }, 5000);
        }
    </script>
</body>
</html>